<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Library Pro - Advanced Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #3b82f6;
            --accent-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-color: #1f2937;
            --light-color: #f3f4f6;
            --white: #ffffff;
            --gray-100: #f9fafb;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            --primary-color: #3b82f6;
            --secondary-color: #60a5fa;
            --accent-color: #22d3ee;
            --success-color: #34d399;
            --warning-color: #fbbf24;
            --danger-color: #f87171;
            --dark-color: #f9fafb;
            --light-color: #1f2937;
            --white: #111827;
            --gray-100: #1f2937;
            --gray-200: #374151;
            --gray-300: #4b5563;
            --gray-400: #6b7280;
            --gray-500: #9ca3af;
            --gray-600: #d1d5db;
            --gray-700: #e5e7eb;
            --gray-800: #f3f4f6;
            --gray-900: #f9fafb;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.4), 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--gray-800);
            transition: var(--transition);
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        /* Auth Pages Styles */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        [data-theme="dark"] .auth-container {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .auth-card {
            background: var(--white);
            border-radius: 20px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 1200px;
            display: flex;
            overflow: hidden;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-left {
            flex: 1;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            padding: 60px 40px;
            color: var(--white);
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .auth-left::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .auth-right {
            flex: 1;
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .auth-logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            z-index: 1;
        }

        .auth-logo i {
            font-size: 2.5rem;
            color: var(--accent-color);
        }

        .auth-logo h1 {
            font-size: 2rem;
            font-weight: 700;
        }

        .auth-welcome {
            font-size: 1.5rem;
            margin-bottom: 15px;
            z-index: 1;
        }

        .auth-description {
            opacity: 0.9;
            line-height: 1.6;
            z-index: 1;
        }

        .auth-features {
            margin-top: 40px;
            z-index: 1;
        }

        .auth-feature {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .auth-feature i {
            font-size: 1.2rem;
            color: var(--accent-color);
        }

        .auth-form h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--gray-800);
        }

        [data-theme="dark"] .auth-form h2 {
            color: var(--gray-200);
        }

        .auth-form p {
            color: var(--gray-600);
            margin-bottom: 30px;
        }

        [data-theme="dark"] .auth-form p {
            color: var(--gray-400);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray-700);
        }

        [data-theme="dark"] .form-label {
            color: var(--gray-300);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            color: var(--gray-800);
        }

        [data-theme="dark"] .form-input {
            background: var(--gray-800);
            border-color: var(--gray-700);
            color: var(--gray-200);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        [data-theme="dark"] .form-input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .form-input.error {
            border-color: var(--danger-color);
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.875rem;
            margin-top: 5px;
            display: none;
        }

        .password-strength {
            height: 4px;
            border-radius: 2px;
            margin-top: 8px;
            background: var(--gray-200);
            overflow: hidden;
        }

        [data-theme="dark"] .password-strength {
            background: var(--gray-700);
        }

        .password-strength-bar {
            height: 100%;
            transition: var(--transition);
            border-radius: 2px;
        }

        .strength-weak { background: var(--danger-color); width: 33%; }
        .strength-medium { background: var(--warning-color); width: 66%; }
        .strength-strong { background: var(--success-color); width: 100%; }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .form-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            color: var(--white);
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        [data-theme="dark"] .btn-secondary {
            background: var(--gray-700);
            color: var(--gray-200);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        [data-theme="dark"] .btn-secondary:hover {
            background: var(--gray-600);
        }

        .btn-success {
            background: var(--success-color);
            color: var(--white);
        }

        .btn-warning {
            background: var(--warning-color);
            color: var(--white);
        }

        .btn-danger {
            background: var(--danger-color);
            color: var(--white);
        }

        .auth-divider {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 30px 0;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--gray-200);
        }

        [data-theme="dark"] .auth-divider::before,
        [data-theme="dark"] .auth-divider::after {
            background: var(--gray-700);
        }

        .social-login {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .social-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            background: var(--white);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        [data-theme="dark"] .social-btn {
            background: var(--gray-800);
            border-color: var(--gray-700);
        }

        .social-btn:hover {
            border-color: var(--secondary-color);
            background: var(--gray-50);
        }

        [data-theme="dark"] .social-btn:hover {
            background: var(--gray-700);
        }

        .auth-footer {
            text-align: center;
            margin-top: 30px;
            color: var(--gray-600);
        }

        [data-theme="dark"] .auth-footer {
            color: var(--gray-400);
        }

        .auth-footer a {
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        /* Main App Styles */
        .app-container {
            display: none;
            min-height: 100vh;
            background: var(--gray-100);
        }

        [data-theme="dark"] .app-container {
            background: var(--gray-900);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: var(--white);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: var(--transition);
        }

        [data-theme="dark"] .sidebar {
            background: var(--gray-800);
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        [data-theme="dark"] .sidebar-header {
            border-bottom-color: var(--gray-700);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-logo i {
            font-size: 1.5rem;
            color: var(--secondary-color);
        }

        .sidebar-logo span {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--gray-800);
        }

        [data-theme="dark"] .sidebar-logo span {
            color: var(--gray-200);
        }

        .sidebar.collapsed .sidebar-logo span {
            display: none;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--gray-600);
            cursor: pointer;
            padding: 5px;
        }

        [data-theme="dark"] .sidebar-toggle {
            color: var(--gray-400);
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-section {
            margin-bottom: 30px;
        }

        .menu-title {
            padding: 0 20px;
            margin-bottom: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--gray-500);
            letter-spacing: 0.05em;
        }

        [data-theme="dark"] .menu-title {
            color: var(--gray-400);
        }

        .sidebar.collapsed .menu-title {
            display: none;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--gray-700);
            text-decoration: none;
            transition: var(--transition);
            position: relative;
            cursor: pointer;
        }

        [data-theme="dark"] .menu-item {
            color: var(--gray-300);
        }

        .menu-item:hover {
            background: var(--gray-50);
            color: var(--secondary-color);
        }

        [data-theme="dark"] .menu-item:hover {
            background: var(--gray-700);
        }

        .menu-item.active {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.1) 0%, transparent 100%);
            color: var(--secondary-color);
        }

        [data-theme="dark"] .menu-item.active {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.2) 0%, transparent 100%);
        }

        .menu-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--secondary-color);
        }

        .menu-item i {
            width: 20px;
            margin-right: 12px;
        }

        .sidebar.collapsed .menu-item span {
            display: none;
        }

        .menu-badge {
            margin-left: auto;
            background: var(--danger-color);
            color: var(--white);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .sidebar.collapsed .menu-badge {
            display: none;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            transition: var(--transition);
        }

        .sidebar.collapsed + .main-content {
            margin-left: 80px;
        }

        /* Header */
        .header {
            background: var(--white);
            box-shadow: var(--shadow);
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        [data-theme="dark"] .header {
            background: var(--gray-800);
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px 10px 40px;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 0.95rem;
            transition: var(--transition);
            background: var(--white);
            color: var(--gray-800);
        }

        [data-theme="dark"] .search-input {
            background: var(--gray-700);
            border-color: var(--gray-600);
            color: var(--gray-200);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
        }

        [data-theme="dark"] .search-icon {
            color: var(--gray-500);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .icon-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--gray-600);
            cursor: pointer;
            position: relative;
            padding: 8px;
            border-radius: 8px;
            transition: var(--transition);
        }

        [data-theme="dark"] .icon-btn {
            color: var(--gray-400);
        }

        .icon-btn:hover {
            background: var(--gray-100);
            color: var(--gray-800);
        }

        [data-theme="dark"] .icon-btn:hover {
            background: var(--gray-700);
            color: var(--gray-200);
        }

        .notification-dot {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            background: var(--danger-color);
            border-radius: 50%;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .user-menu:hover {
            background: var(--gray-100);
        }

        [data-theme="dark"] .user-menu:hover {
            background: var(--gray-700);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--accent-color) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 600;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: var(--gray-800);
            font-size: 0.9rem;
        }

        [data-theme="dark"] .user-name {
            color: var(--gray-200);
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        [data-theme="dark"] .user-role {
            color: var(--gray-400);
        }

        /* Dashboard */
        .dashboard {
            padding: 30px;
        }

        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        [data-theme="dark"] .dashboard-title {
            color: var(--gray-200);
        }

        .dashboard-subtitle {
            color: var(--gray-600);
        }

        [data-theme="dark"] .dashboard-subtitle {
            color: var(--gray-400);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .stat-card {
            background: var(--gray-800);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, transparent 100%);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        [data-theme="dark"] .stat-card::before {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, transparent 100%);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-icon.blue {
            background: rgba(59, 130, 246, 0.1);
            color: var(--secondary-color);
        }

        [data-theme="dark"] .stat-icon.blue {
            background: rgba(59, 130, 246, 0.2);
        }

        .stat-icon.green {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        [data-theme="dark"] .stat-icon.green {
            background: rgba(16, 185, 129, 0.2);
        }

        .stat-icon.yellow {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        [data-theme="dark"] .stat-icon.yellow {
            background: rgba(245, 158, 11, 0.2);
        }

        .stat-icon.red {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        [data-theme="dark"] .stat-icon.red {
            background: rgba(239, 68, 68, 0.2);
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .stat-trend.up {
            color: var(--success-color);
        }

        .stat-trend.down {
            color: var(--danger-color);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        [data-theme="dark"] .stat-value {
            color: var(--gray-200);
        }

        .stat-label {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        [data-theme="dark"] .stat-label {
            color: var(--gray-400);
        }

        /* Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: var(--white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        [data-theme="dark"] .chart-card {
            background: var(--gray-800);
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        [data-theme="dark"] .chart-title {
            color: var(--gray-200);
        }

        .chart-options {
            display: flex;
            gap: 8px;
        }

        .chart-option {
            padding: 6px 12px;
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            background: var(--white);
            color: var(--gray-600);
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
        }

        [data-theme="dark"] .chart-option {
            background: var(--gray-700);
            border-color: var(--gray-600);
            color: var(--gray-300);
        }

        .chart-option.active {
            background: var(--secondary-color);
            color: var(--white);
            border-color: var(--secondary-color);
        }

        /* Tables */
        .table-card {
            background: var(--white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        [data-theme="dark"] .table-card {
            background: var(--gray-800);
        }

        .table-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .table-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        [data-theme="dark"] .table-title {
            color: var(--gray-200);
        }

        .table-actions {
            display: flex;
            gap: 12px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: left;
            padding: 12px;
            border-bottom: 2px solid var(--gray-200);
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        [data-theme="dark"] .data-table th {
            border-bottom-color: var(--gray-700);
            color: var(--gray-300);
        }

        .data-table td {
            padding: 16px 12px;
            border-bottom: 1px solid var(--gray-100);
            color: var(--gray-700);
        }

        [data-theme="dark"] .data-table td {
            border-bottom-color: var(--gray-700);
            color: var(--gray-300);
        }

        .data-table tr:hover {
            background: var(--gray-50);
        }

        [data-theme="dark"] .data-table tr:hover {
            background: var(--gray-700);
        }

        .table-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        [data-theme="dark"] .badge-success {
            background: rgba(16, 185, 129, 0.2);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        [data-theme="dark"] .badge-warning {
            background: rgba(245, 158, 11, 0.2);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        [data-theme="dark"] .badge-danger {
            background: rgba(239, 68, 68, 0.2);
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--secondary-color);
        }

        [data-theme="dark"] .badge-info {
            background: rgba(59, 130, 246, 0.2);
        }

        .table-actions-btn {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.875rem;
        }

        .action-btn.edit {
            background: rgba(59, 130, 246, 0.1);
            color: var(--secondary-color);
        }

        [data-theme="dark"] .action-btn.edit {
            background: rgba(59, 130, 246, 0.2);
        }

        .action-btn.edit:hover {
            background: var(--secondary-color);
            color: var(--white);
        }

        .action-btn.delete {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        [data-theme="dark"] .action-btn.delete {
            background: rgba(239, 68, 68, 0.2);
        }

        .action-btn.delete:hover {
            background: var(--danger-color);
            color: var(--white);
        }

        .action-btn.view {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        [data-theme="dark"] .action-btn.view {
            background: rgba(16, 185, 129, 0.2);
        }

        .action-btn.view:hover {
            background: var(--success-color);
            color: var(--white);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease-out;
        }

        [data-theme="dark"] .modal-content {
            background: var(--gray-800);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        [data-theme="dark"] .modal-header {
            border-bottom-color: var(--gray-700);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        [data-theme="dark"] .modal-title {
            color: var(--gray-200);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-400);
            cursor: pointer;
            padding: 4px;
        }

        [data-theme="dark"] .modal-close {
            color: var(--gray-500);
        }

        .modal-close:hover {
            color: var(--gray-600);
        }

        [data-theme="dark"] .modal-close:hover {
            color: var(--gray-400);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 24px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        [data-theme="dark"] .modal-footer {
            border-top-color: var(--gray-700);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 12px;
            background: var(--white);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            transform: translateX(400px);
            transition: transform 0.3s ease-out;
            z-index: 3000;
        }

        [data-theme="dark"] .notification {
            background: var(--gray-800);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .notification.success .notification-icon {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        [data-theme="dark"] .notification.success .notification-icon {
            background: rgba(16, 185, 129, 0.2);
        }

        .notification.error .notification-icon {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        [data-theme="dark"] .notification.error .notification-icon {
            background: rgba(239, 68, 68, 0.2);
        }

        .notification.warning .notification-icon {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        [data-theme="dark"] .notification.warning .notification-icon {
            background: rgba(245, 158, 11, 0.2);
        }

        .notification.info .notification-icon {
            background: rgba(59, 130, 246, 0.1);
            color: var(--secondary-color);
        }

        [data-theme="dark"] .notification.info .notification-icon {
            background: rgba(59, 130, 246, 0.2);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        [data-theme="dark"] .notification-title {
            color: var(--gray-200);
        }

        .notification-message {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        [data-theme="dark"] .notification-message {
            color: var(--gray-400);
        }

        /* Loading Spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--gray-200);
            border-radius: 50%;
            border-top-color: var(--secondary-color);
            animation: spin 1s linear infinite;
        }

        [data-theme="dark"] .loading {
            border-color: var(--gray-700);
            border-top-color: var(--secondary-color);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Progress Bar */
        .progress-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        [data-theme="dark"] .progress-bar {
            background: var(--gray-700);
        }

        .progress-fill {
            height: 100%;
            background: var(--success-color);
            transition: width 0.3s ease;
        }

        /* Permission Restricted */
        .permission-restricted {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
        }

        .permission-restricted i {
            font-size: 4rem;
            color: var(--gray-400);
            margin-bottom: 20px;
        }

        [data-theme="dark"] .permission-restricted i {
            color: var(--gray-600);
        }

        .permission-restricted h3 {
            font-size: 1.5rem;
            color: var(--gray-700);
            margin-bottom: 10px;
        }

        [data-theme="dark"] .permission-restricted h3 {
            color: var(--gray-300);
        }

        .permission-restricted p {
            color: var(--gray-500);
            max-width: 400px;
        }

        [data-theme="dark"] .permission-restricted p {
            color: var(--gray-400);
        }

        /* Book Grid View */
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .book-card {
            background: var(--white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
        }

        [data-theme="dark"] .book-card {
            background: var(--gray-800);
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .book-cover {
            height: 300px;
            background: var(--gray-200);
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .book-cover {
            background: var(--gray-700);
        }

        .book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .book-cover-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: var(--gray-500);
        }

        [data-theme="dark"] .book-cover-placeholder {
            color: var(--gray-400);
        }

        .book-cover-placeholder i {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .book-info {
            padding: 16px;
        }

        .book-title {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        [data-theme="dark"] .book-title {
            color: var(--gray-200);
        }

        .book-author {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        [data-theme="dark"] .book-author {
            color: var(--gray-400);
        }

        .book-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .book-status.available {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        [data-theme="dark"] .book-status.available {
            background: rgba(16, 185, 129, 0.2);
        }

        .book-status.borrowed {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        [data-theme="dark"] .book-status.borrowed {
            background: rgba(245, 158, 11, 0.2);
        }

        /* Book Detail View */
        .book-detail-container {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }

        .book-detail-cover {
            flex: 0 0 300px;
            height: 400px;
            background: var(--gray-200);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        [data-theme="dark"] .book-detail-cover {
            background: var(--gray-700);
        }

        .book-detail-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .book-detail-info {
            flex: 1;
        }

        .book-detail-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        [data-theme="dark"] .book-detail-title {
            color: var(--gray-200);
        }

        .book-detail-author {
            font-size: 1.2rem;
            color: var(--gray-600);
            margin-bottom: 16px;
        }

        [data-theme="dark"] .book-detail-author {
            color: var(--gray-400);
        }

        .book-detail-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 24px;
        }

        .book-detail-meta-item {
            display: flex;
            flex-direction: column;
        }

        .book-detail-meta-label {
            font-size: 0.875rem;
            color: var(--gray-500);
            margin-bottom: 4px;
        }

        [data-theme="dark"] .book-detail-meta-label {
            color: var(--gray-400);
        }

        .book-detail-meta-value {
            font-weight: 600;
            color: var(--gray-800);
        }

        [data-theme="dark"] .book-detail-meta-value {
            color: var(--gray-200);
        }

        .book-detail-description {
            margin-bottom: 24px;
            line-height: 1.6;
            color: var(--gray-700);
        }

        [data-theme="dark"] .book-detail-description {
            color: var(--gray-300);
        }

        .book-detail-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* PDF Reader */
        .pdf-reader-container {
            background: var(--white);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin-bottom: 30px;
        }

        [data-theme="dark"] .pdf-reader-container {
            background: var(--gray-800);
        }

        .pdf-reader-header {
            padding: 16px 24px;
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--gray-200);
        }

        [data-theme="dark"] .pdf-reader-header {
            background: var(--gray-700);
            border-bottom-color: var(--gray-600);
        }

        .pdf-reader-title {
            font-weight: 600;
            color: var(--gray-800);
        }

        [data-theme="dark"] .pdf-reader-title {
            color: var(--gray-200);
        }

        .pdf-reader-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .pdf-reader-page {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pdf-reader-page input {
            width: 50px;
            padding: 6px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            text-align: center;
            background: var(--white);
            color: var(--gray-800);
        }

        [data-theme="dark"] .pdf-reader-page input {
            background: var(--gray-700);
            border-color: var(--gray-600);
            color: var(--gray-200);
        }

        .pdf-reader-content {
            height: 600px;
            overflow: auto;
            display: flex;
            justify-content: center;
            padding: 20px;
            background: var(--gray-50);
        }

        [data-theme="dark"] .pdf-reader-content {
            background: var(--gray-900);
        }

        .pdf-page {
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
        }

        /* File Upload */
        .file-upload {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border: 2px dashed var(--gray-300);
            border-radius: 10px;
            background: var(--gray-50);
            cursor: pointer;
            transition: var(--transition);
        }

        [data-theme="dark"] .file-upload {
            border-color: var(--gray-600);
            background: var(--gray-700);
        }

        .file-upload:hover {
            border-color: var(--secondary-color);
            background: rgba(59, 130, 246, 0.05);
        }

        [data-theme="dark"] .file-upload:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-icon {
            font-size: 2rem;
            color: var(--gray-400);
            margin-bottom: 8px;
        }

        [data-theme="dark"] .file-upload-icon {
            color: var(--gray-500);
        }

        .file-upload-text {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        [data-theme="dark"] .file-upload-text {
            color: var(--gray-400);
        }

        .file-upload.has-file {
            border-color: var(--success-color);
            background: rgba(16, 185, 129, 0.05);
        }

        [data-theme="dark"] .file-upload.has-file {
            background: rgba(16, 185, 129, 0.1);
        }

        .file-upload.has-file .file-upload-icon {
            color: var(--success-color);
        }

        /* Book Info Overlay */
        .book-info-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 100%);
            padding: 20px 16px 16px;
            transform: translateY(100%);
            transition: var(--transition);
        }

        .book-card:hover .book-info-overlay {
            transform: translateY(0);
        }

        .info-btn {
            background: var(--secondary-color);
            color: var(--white);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            width: 100%;
            justify-content: center;
        }

        .info-btn:hover {
            background: var(--primary-color);
            transform: translateY(-2px);
        }

        /* Info Panel */
        .info-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--white);
            box-shadow: -4px 0 20px rgba(0,0,0,0.1);
            z-index: 1500;
            transition: var(--transition);
            overflow-y: auto;
        }

        [data-theme="dark"] .info-panel {
            background: var(--gray-800);
        }

        .info-panel.active {
            right: 0;
        }

        .info-panel-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        [data-theme="dark"] .info-panel-header {
            border-bottom-color: var(--gray-700);
        }

        .info-panel-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        [data-theme="dark"] .info-panel-title {
            color: var(--gray-200);
        }

        .info-panel-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--gray-400);
            cursor: pointer;
            padding: 4px;
        }

        [data-theme="dark"] .info-panel-close {
            color: var(--gray-500);
        }

        .info-panel-close:hover {
            color: var(--gray-600);
        }

        [data-theme="dark"] .info-panel-close:hover {
            color: var(--gray-400);
        }

        .info-panel-body {
            padding: 20px;
        }

        .info-panel-cover {
            width: 100%;
            height: 200px;
            background: var(--gray-200);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        [data-theme="dark"] .info-panel-cover {
            background: var(--gray-700);
        }

        .info-panel-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .info-panel-book-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 8px;
        }

        [data-theme="dark"] .info-panel-book-title {
            color: var(--gray-200);
        }

        .info-panel-book-author {
            color: var(--gray-600);
            margin-bottom: 16px;
        }

        [data-theme="dark"] .info-panel-book-author {
            color: var(--gray-400);
        }

        .info-panel-meta {
            margin-bottom: 20px;
        }

        .info-panel-meta-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        [data-theme="dark"] .info-panel-meta-item {
            border-bottom-color: var(--gray-700);
        }

        .info-panel-meta-label {
            color: var(--gray-500);
            font-size: 0.875rem;
        }

        [data-theme="dark"] .info-panel-meta-label {
            color: var(--gray-400);
        }

        .info-panel-meta-value {
            color: var(--gray-800);
            font-weight: 500;
        }

        [data-theme="dark"] .info-panel-meta-value {
            color: var(--gray-200);
        }

        .info-panel-description {
            color: var(--gray-700);
            line-height: 1.6;
            margin-bottom: 20px;
        }

        [data-theme="dark"] .info-panel-description {
            color: var(--gray-300);
        }

        .info-panel-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .info-panel-action-btn {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .info-panel-action-btn.primary {
            background: var(--secondary-color);
            color: var(--white);
        }

        .info-panel-action-btn.primary:hover {
            background: var(--primary-color);
        }

        .info-panel-action-btn.success {
            background: var(--success-color);
            color: var(--white);
        }

        .info-panel-action-btn.success:hover {
            background: #059669;
        }

        .info-panel-action-btn.secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        [data-theme="dark"] .info-panel-action-btn.secondary {
            background: var(--gray-700);
            color: var(--gray-200);
        }

        .info-panel-action-btn.secondary:hover {
            background: var(--gray-300);
        }

        [data-theme="dark"] .info-panel-action-btn.secondary:hover {
            background: var(--gray-600);
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1400;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        /* Book Card Actions */
        .book-card-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: var(--transition);
        }

        .book-card:hover .book-card-actions {
            opacity: 1;
        }

        .book-card-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--white);
            color: var(--gray-700);
            border: none;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        [data-theme="dark"] .book-card-action-btn {
            background: var(--gray-700);
            color: var(--gray-300);
        }

        .book-card-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .book-card-action-btn.edit {
            color: var(--secondary-color);
        }

        .book-card-action-btn.delete {
            color: var(--danger-color);
        }

        /* Profile Section */
        .profile-container {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }

        .profile-sidebar {
            flex: 0 0 300px;
        }

        .profile-card {
            background: var(--white);
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--shadow);
            text-align: center;
            margin-bottom: 20px;
        }

        [data-theme="dark"] .profile-card {
            background: var(--gray-800);
        }

        .profile-avatar-container {
            position: relative;
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
        }

        .profile-avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--secondary-color);
        }

        .profile-avatar-upload {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary-color);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .profile-avatar-upload:hover {
            background: var(--primary-color);
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 5px;
        }

        [data-theme="dark"] .profile-name {
            color: var(--gray-200);
        }

        .profile-role {
            color: var(--gray-600);
            margin-bottom: 20px;
        }

        [data-theme="dark"] .profile-role {
            color: var(--gray-400);
        }

        .profile-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-200);
        }

        [data-theme="dark"] .profile-stats {
            border-top-color: var(--gray-700);
        }

        .profile-stat {
            text-align: center;
        }

        .profile-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        [data-theme="dark"] .profile-stat-value {
            color: var(--gray-200);
        }

        .profile-stat-label {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        [data-theme="dark"] .profile-stat-label {
            color: var(--gray-400);
        }

        .profile-content {
            flex: 1;
        }

        .profile-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--gray-200);
        }

        [data-theme="dark"] .profile-tabs {
            border-bottom-color: var(--gray-700);
        }

        .profile-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--gray-600);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        [data-theme="dark"] .profile-tab {
            color: var(--gray-400);
        }

        .profile-tab.active {
            color: var(--secondary-color);
            border-bottom-color: var(--secondary-color);
        }

        .profile-tab:hover {
            color: var(--secondary-color);
        }

        .profile-tab-content {
            display: none;
        }

        .profile-tab-content.active {
            display: block;
        }

        .profile-form {
            background: var(--white);
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--shadow);
        }

        [data-theme="dark"] .profile-form {
            background: var(--gray-800);
        }

        .profile-form-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 20px;
        }

        [data-theme="dark"] .profile-form-title {
            color: var(--gray-200);
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
        }

        .form-group.half {
            flex: 0 0 calc(50% - 10px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .auth-card {
                flex-direction: column;
                max-width: 400px;
            }

            .auth-left {
                padding: 40px 30px;
            }

            .auth-right {
                padding: 40px 30px;
            }

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .charts-section {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .table-card {
                overflow-x: auto;
            }

            .data-table {
                min-width: 600px;
            }

            .book-detail-container {
                flex-direction: column;
            }

            .book-detail-cover {
                flex: 0 0 auto;
                height: 300px;
            }

            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .info-panel {
                width: 100%;
                right: -100%;
            }

            .profile-container {
                flex-direction: column;
            }

            .profile-sidebar {
                flex: 0 0 auto;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .form-group.half {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Login/Register Container -->
    <div id="authContainer" class="auth-container">
        <!-- Login Card -->
        <div id="loginCard" class="auth-card">
            <div class="auth-left">
                <div class="auth-logo">
                    <i class="fas fa-book-open"></i>
                    <h1>Library Pro</h1>
                </div>
                <h2 class="auth-welcome">Welcome Back!</h2>
                <p class="auth-description">
                    Access thousands of books, manage your library, and connect with readers worldwide.
                </p>
                <div class="auth-features">
                    <div class="auth-feature">
                        <i class="fas fa-book"></i>
                        <span>10,000+ Books Collection</span>
                    </div>
                    <div class="auth-feature">
                        <i class="fas fa-users"></i>
                        <span>Active Community</span>
                    </div>
                    <div class="auth-feature">
                        <i class="fas fa-shield-alt"></i>
                        <span>Secure & Private</span>
                    </div>
                    <div class="auth-feature">
                        <i class="fas fa-mobile-alt"></i>
                        <span>Access Anywhere</span>
                    </div>
                </div>
            </div>
            <div class="auth-right">
                <form class="auth-form" id="loginForm">
                    <h2>Sign In</h2>
                    <p>Enter your credentials to access your account</p>
                    
                   
                    <div class="form-group">
                        <label class="form-label">Email or Username</label>
                        <input type="text" class="form-input" id="loginEmail" placeholder="Enter your email or username" required>
                        <span class="error-message" id="loginEmailError">Please enter a valid email or username</span>
                    </div>
                   
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password" required>
                        <span class="error-message" id="loginPasswordError">Password is required</span>
                    </div>
                   
                    <div class="form-checkbox">
                        <input type="checkbox" id="rememberMe">
                        <label for="rememberMe">Remember me for 30 days</label>
                    </div>
                   
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i>
                        Sign In
                    </button>
                   
                    <div class="auth-divider">
                        <span>or continue with</span>
                    </div>
                   
                    <div class="social-login">
                        <button type="button" class="social-btn">
                            <i class="fab fa-google"></i>
                            Google
                        </button>
                        <button type="button" class="social-btn">
                            <i class="fab fa-microsoft"></i>
                            Microsoft
                        </button>
                    </div>
                   
                    <div class="auth-footer">
                        Don't have an account? <a href="#" onclick="showRegister()">Sign up</a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Register Card -->
        <div id="registerCard" class="auth-card" style="display: none;">
            <div class="auth-left">
                <div class="auth-logo">
                    <i class="fas fa-book-open"></i>
                    <h1>Join Library Pro</h1>
                </div>
                <h2 class="auth-welcome">Create Account</h2>
                <p class="auth-description">
                    Join our community of book lovers and unlock a world of knowledge and entertainment.
                </p>
                <div class="auth-features">
                    <div class="auth-feature">
                        <i class="fas fa-book-reader"></i>
                        <span>Personalized Recommendations</span>
                    </div>
                    <div class="auth-feature">
                        <i class="fas fa-bookmark"></i>
                        <span>Save & Organize Books</span>
                    </div>
                    <div class="auth-feature">
                        <i class="fas fa-star"></i>
                        <span>Rate & Review Books</span>
                    </div>
                    <div class="auth-feature">
                        <i class="fas fa-users"></i>
                        <span>Join Book Clubs</span>
                    </div>
                </div>
            </div>
            <div class="auth-right">
                <form class="auth-form" id="registerForm">
                    <h2>Create Account</h2>
                    <p>Fill in your information to get started</p>
                   
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" id="registerName" placeholder="Enter your full name" required>
                        <span class="error-message" id="registerNameError">Name is required</span>
                    </div>
                   
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" id="registerEmail" placeholder="Enter your email" required>
                        <span class="error-message" id="registerEmailError">Please enter a valid email</span>
                    </div>
                   
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-input" id="registerUsername" placeholder="Choose a username" required>
                        <span class="error-message" id="registerUsernameError">Username is required</span>
                    </div>
                   
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="registerPassword" placeholder="Create a strong password" required>
                        <div class="password-strength">
                            <div class="password-strength-bar" id="passwordStrengthBar"></div>
                        </div>
                        <span class="error-message" id="registerPasswordError">Password must be at least 8 characters</span>
                    </div>
                   
                    <div class="form-group">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" class="form-input" id="registerConfirmPassword" placeholder="Confirm your password" required>
                        <span class="error-message" id="registerConfirmPasswordError">Passwords do not match</span>
                    </div>
                   
                    <div class="form-checkbox">
                        <input type="checkbox" id="agreeTerms" required>
                        <label for="agreeTerms">I agree to the Terms of Service and Privacy Policy</label>
                    </div>
                   
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i>
                        Create Account
                    </button>
                   
                    <div class="auth-footer">
                        Already have an account? <a href="#" onclick="showLogin()">Sign in</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-book-open"></i>
                    <span>Library Pro</span>
                </div>
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
           
            <nav class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-title">Main</div>
                    <a href="#" class="menu-item active" onclick="showSection('dashboard')">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" class="menu-item" onclick="showSection('books')">
                        <i class="fas fa-book"></i>
                        <span>Books</span>
                    </a>
                    <a href="#" class="menu-item" onclick="showSection('users')" id="usersMenuItem" style="display: none;">
                        <i class="fas fa-users"></i>
                        <span>Users</span>
                        <span class="menu-badge" id="userCountBadge">0</span>
                    </a>
                    <a href="#" class="menu-item" onclick="showSection('borrowing')" id="borrowingMenuItem" style="display: none;">
                        <i class="fas fa-hand-holding"></i>
                        <span>Borrowing</span>
                    </a>
                    <a href="#" class="menu-item" onclick="showSection('reservations')" id="reservationsMenuItem" style="display: none;">
                        <i class="fas fa-bookmark"></i>
                        <span>Reservations</span>
                    </a>
                    <a href="#" class="menu-item" onclick="showSection('profile')">
                        <i class="fas fa-user-circle"></i>
                        <span>Profile</span>
                    </a>
                </div>
               
                <div class="menu-section" id="adminMenuSection" style="display: none;">
                    <div class="menu-title">Management</div>
                    <a href="#" class="menu-item" onclick="showSection('fines')">
                        <i class="fas fa-dollar-sign"></i>
                        <span>Fines</span>
                    </a>
                    <a href="#" class="menu-item" onclick="showSection('reports')">
                        <i class="fas fa-chart-bar"></i>
                        <span>Reports</span>
                    </a>
                    <a href="#" class="menu-item" onclick="showSection('settings')">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </div>
               
                <div class="menu-section" id="systemMenuSection" style="display: none;">
                    <div class="menu-title">System</div>
                    <a href="#" class="menu-item" onclick="showSection('backup')">
                        <i class="fas fa-database"></i>
                        <span>Backup & Restore</span>
                    </a>
                    <a href="#" class="menu-item" onclick="showSection('logs')">
                        <i class="fas fa-file-alt"></i>
                        <span>System Logs</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="search-bar">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Search books, users, or anything...">
                </div>
               
                <div class="header-actions">
                    <button class="icon-btn" onclick="showNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="notification-dot"></span>
                    </button>
                    <button class="icon-btn" onclick="toggleDarkMode()">
                        <i class="fas fa-moon" id="darkModeIcon"></i>
                    </button>
                    <div class="user-menu" onclick="showUserMenu()">
                        <div class="user-avatar" id="userAvatar">A</div>
                        <div class="user-info">
                            <div class="user-name" id="userName">Admin User</div>
                            <div class="user-role" id="userRole">Administrator</div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Dashboard Section -->
            <section id="dashboardSection" class="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Dashboard Overview</h1>
                    <p class="dashboard-subtitle">Welcome back! Here's what's happening in your library today.</p>
                </div>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="stat-trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>12%</span>
                            </div>
                        </div>
                        <div class="stat-value" id="totalBooksStat">0</div>
                        <div class="stat-label">Total Books</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon green">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>8%</span>
                            </div>
                        </div>
                        <div class="stat-value" id="totalUsersStat">0</div>
                        <div class="stat-label">Active Users</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon yellow">
                                <i class="fas fa-hand-holding"></i>
                            </div>
                            <div class="stat-trend down">
                                <i class="fas fa-arrow-down"></i>
                                <span>3%</span>
                            </div>
                        </div>
                        <div class="stat-value" id="borrowedBooksStat">0</div>
                        <div class="stat-label">Borrowed Books</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon red">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="stat-trend up">
                                <i class="fas fa-arrow-up"></i>
                                <span>5%</span>
                            </div>
                        </div>
                        <div class="stat-value" id="overdueBooksStat">0</div>
                        <div class="stat-label">Overdue Books</div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-section">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">Library Usage</h3>
                            <div class="chart-options">
                                <button class="chart-option active">Weekly</button>
                                <button class="chart-option">Monthly</button>
                                <button class="chart-option">Yearly</button>
                            </div>
                        </div>
                        <canvas id="usageChart" height="300"></canvas>
                    </div>
                </div>

                <!-- Recent Activities Table -->
                <div class="table-card">
                    <div class="table-header">
                        <h3 class="table-title">Recent Activities</h3>
                        <div class="table-actions">
                            <button class="btn btn-secondary" onclick="refreshActivities()">
                                <i class="fas fa-sync-alt"></i>
                                Refresh
                            </button>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Action</th>
                                <th>Book</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="activitiesTable">
                            <!-- Activities will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Books Management Section -->
            <section id="booksSection" class="dashboard" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Books Collection</h1>
                    <p class="dashboard-subtitle">Browse and explore our library's book collection</p>
                </div>

                <div class="table-card">
                    <div class="table-header">
                        <h3 class="table-title">All Books</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary" id="addBookBtn" onclick="showAddBookModal()" style="display: none;">
                                <i class="fas fa-plus"></i>
                                Add Book
                            </button>
                            <button class="btn btn-secondary" id="importBooksBtn" onclick="importBooks()" style="display: none;">
                                <i class="fas fa-file-import"></i>
                                Import
                            </button>
                            <button class="btn btn-secondary" id="exportBooksBtn" onclick="exportBooks()" style="display: none;">
                                <i class="fas fa-file-export"></i>
                                Export
                            </button>
                        </div>
                    </div>
                    
                    <!-- Books Grid View -->
                    <div class="books-grid" id="booksGrid">
                        <!-- Books will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Users Management Section -->
            <section id="usersSection" class="dashboard" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Users Management</h1>
                    <p class="dashboard-subtitle">Manage library users and their permissions</p>
                </div>

                <div class="table-card">
                    <div class="table-header">
                        <h3 class="table-title">All Users</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary" onclick="showAddUserModal()">
                                <i class="fas fa-user-plus"></i>
                                Add User
                            </button>
                            <button class="btn btn-secondary" onclick="exportUsers()">
                                <i class="fas fa-file-export"></i>
                                Export
                            </button>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Member Since</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Borrowing Section -->
            <section id="borrowingSection" class="dashboard" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Borrowing Management</h1>
                    <p class="dashboard-subtitle">Manage book borrowing and returns</p>
                </div>

                <div class="table-card">
                    <div class="table-header">
                        <h3 class="table-title">Active Borrowings</h3>
                        <div class="table-actions">
                            <button class="btn btn-primary" onclick="showBorrowBookModal()">
                                <i class="fas fa-hand-holding"></i>
                                Borrow Book
                            </button>
                            <button class="btn btn-success" onclick="showReturnBookModal()">
                                <i class="fas fa-undo"></i>
                                Return Book
                            </button>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Book</th>
                                <th>Borrow Date</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="borrowingsTable">
                            <!-- Borrowings will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Profile Section -->
            <section id="profileSection" class="dashboard" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">My Profile</h1>
                    <p class="dashboard-subtitle">Manage your personal information and preferences</p>
                </div>

                <div class="profile-container">
                    <div class="profile-sidebar">
                        <div class="profile-card">
                            <div class="profile-avatar-container">
                                <img id="profileAvatarImg" src="https://picsum.photos/seed/profile/300/300.jpg" alt="Profile" class="profile-avatar">
                                <label for="profileAvatarUpload" class="profile-avatar-upload">
                                    <i class="fas fa-camera"></i>
                                </label>
                                <input type="file" id="profileAvatarUpload" accept="image/*" onchange="handleProfileAvatarUpload(this)" style="display: none;">
                            </div>
                            <h2 class="profile-name" id="profileName">Admin User</h2>
                            <p class="profile-role" id="profileRole">Administrator</p>
                            
                            <div class="profile-stats">
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="profileBooksBorrowed">0</div>
                                    <div class="profile-stat-label">Books Borrowed</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="profileBooksReserved">0</div>
                                    <div class="profile-stat-label">Books Reserved</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="profileFines">$0</div>
                                    <div class="profile-stat-label">Fines</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="profile-content">
                        <div class="profile-tabs">
                            <button class="profile-tab active" onclick="showProfileTab('personal')">Personal Information</button>
                            <button class="profile-tab" onclick="showProfileTab('security')">Security</button>
                            <button class="profile-tab" onclick="showProfileTab('preferences')">Preferences</button>
                            <button class="profile-tab" onclick="showProfileTab('activity')">Activity</button>
                        </div>

                        <div id="personalTab" class="profile-tab-content active">
                            <div class="profile-form">
                                <h3 class="profile-form-title">Personal Information</h3>
                                <form id="profilePersonalForm">
                                    <div class="form-row">
                                        <div class="form-group half">
                                            <label class="form-label">First Name</label>
                                            <input type="text" class="form-input" id="profileFirstName" value="Admin">
                                        </div>
                                        <div class="form-group half">
                                            <label class="form-label">Last Name</label>
                                            <input type="text" class="form-input" id="profileLastName" value="User">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email Address</label>
                                        <input type="email" class="form-input" id="profileEmail" value="admin@library.com">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Username</label>
                                        <input type="text" class="form-input" id="profileUsername" value="admin">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Phone Number</label>
                                        <input type="tel" class="form-input" id="profilePhone" placeholder="Enter your phone number">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Bio</label>
                                        <textarea class="form-input" id="profileBio" rows="4" placeholder="Tell us about yourself"></textarea>
                                    </div>
                                    <button type="button" class="btn btn-primary" onclick="saveProfilePersonalInfo()">
                                        <i class="fas fa-save"></i>
                                        Save Changes
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div id="securityTab" class="profile-tab-content">
                            <div class="profile-form">
                                <h3 class="profile-form-title">Security Settings</h3>
                                <form id="profileSecurityForm">
                                    <div class="form-group">
                                        <label class="form-label">Current Password</label>
                                        <input type="password" class="form-input" id="currentPassword" placeholder="Enter current password">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">New Password</label>
                                        <input type="password" class="form-input" id="newPassword" placeholder="Enter new password">
                                        <div class="password-strength">
                                            <div class="password-strength-bar" id="newPasswordStrengthBar"></div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Confirm New Password</label>
                                        <input type="password" class="form-input" id="confirmNewPassword" placeholder="Confirm new password">
                                    </div>
                                    <button type="button" class="btn btn-primary" onclick="changePassword()">
                                        <i class="fas fa-lock"></i>
                                        Change Password
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div id="preferencesTab" class="profile-tab-content">
                            <div class="profile-form">
                                <h3 class="profile-form-title">Preferences</h3>
                                <form id="profilePreferencesForm">
                                    <div class="form-group">
                                        <label class="form-label">Language</label>
                                        <select class="form-input" id="profileLanguage">
                                            <option value="en">English</option>
                                            <option value="es">Spanish</option>
                                            <option value="fr">French</option>
                                            <option value="de">German</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Theme</label>
                                        <select class="form-input" id="profileTheme" onchange="changeTheme(this.value)">
                                            <option value="light">Light</option>
                                            <option value="dark">Dark</option>
                                            <option value="auto">Auto (System)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email Notifications</label>
                                        <div class="form-checkbox">
                                            <input type="checkbox" id="emailNotifications" checked>
                                            <label for="emailNotifications">Receive email notifications</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Push Notifications</label>
                                        <div class="form-checkbox">
                                            <input type="checkbox" id="pushNotifications" checked>
                                            <label for="pushNotifications">Receive push notifications</label>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-primary" onclick="saveProfilePreferences()">
                                        <i class="fas fa-save"></i>
                                        Save Preferences
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div id="activityTab" class="profile-tab-content">
                            <div class="profile-form">
                                <h3 class="profile-form-title">Recent Activity</h3>
                                <div class="table-card">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Action</th>
                                                <th>Details</th>
                                                <th>Date</th>
                                            </tr>
                                        </thead>
                                        <tbody id="profileActivityTable">
                                            <!-- User activities will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settingsSection" class="dashboard" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">System Settings</h1>
                    <p class="dashboard-subtitle">Configure your library system</p>
                </div>

                <div class="table-card">
                    <div class="permission-restricted" id="settingsRestricted" style="display: none;">
                        <i class="fas fa-lock"></i>
                        <h3>Admin Access Required</h3>
                        <p>You need administrator privileges to access system settings. Please contact your system administrator.</p>
                    </div>

                    <div id="settingsContent">
                        <div class="form-group">
                            <label class="form-label">Library Name</label>
                            <input type="text" class="form-input" id="libraryName" value="Digital Library Pro">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Max Books Per User</label>
                            <input type="number" class="form-input" id="maxBooks" value="5">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Borrowing Period (Days)</label>
                            <input type="number" class="form-input" id="borrowingPeriod" value="14">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fine Per Day ($)</label>
                            <input type="number" class="form-input" id="finePerDay" value="0.50" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Auto Renewal</label>
                            <div class="form-checkbox">
                                <input type="checkbox" id="autoRenewal" checked>
                                <label for="autoRenewal">Allow automatic renewal of borrowed books</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email Notifications</label>
                            <div class="form-checkbox">
                                <input type="checkbox" id="emailNotifications" checked>
                                <label for="emailNotifications">Send email notifications for due dates and new books</label>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveSettings()">
                            <i class="fas fa-save"></i>
                            Save Settings
                        </button>
                    </div>
                </div>
            </section>

            <!-- PDF Reader Section -->
            <section id="pdfReaderSection" class="dashboard" style="display: none;">
                <div class="dashboard-header">
                    <button class="btn btn-secondary" onclick="backToBookInfo()">
                        <i class="fas fa-arrow-left"></i>
                        Back to Book Info
                    </button>
                </div>

                <div class="pdf-reader-container">
                    <div class="pdf-reader-header">
                        <h3 class="pdf-reader-title" id="pdfReaderTitle"></h3>
                        <div class="pdf-reader-controls">
                            <div class="pdf-reader-page">
                                <button class="btn btn-secondary" onclick="previousPage()">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span>Page</span>
                                <input type="number" id="currentPage" value="1" min="1" onchange="goToPage()">
                                <span>of</span>
                                <span id="totalPages">0</span>
                                <button class="btn btn-secondary" onclick="nextPage()">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                            <button class="btn btn-secondary" onclick="zoomOut()">
                                <i class="fas fa-search-minus"></i>
                            </button>
                            <button class="btn btn-secondary" onclick="zoomIn()">
                                <i class="fas fa-search-plus"></i>
                            </button>
                            <button class="btn btn-secondary" onclick="downloadPDF()">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <div class="pdf-reader-content" id="pdfReaderContent">
                        <!-- PDF pages will be rendered here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Book Modal -->
    <div id="addBookModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Book</h2>
                <button class="modal-close" onclick="closeModal('addBookModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addBookForm">
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" class="form-input" id="bookTitle" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Author *</label>
                        <input type="text" class="form-input" id="bookAuthor" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-input" id="bookCategory" required>
                            <option value="">Select Category</option>
                            <option value="fiction">Fiction</option>
                            <option value="non-fiction">Non-Fiction</option>
                            <option value="science">Science</option>
                            <option value="history">History</option>
                            <option value="technology">Technology</option>
                            <option value="art">Art</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ISBN *</label>
                        <input type="text" class="form-input" id="bookISBN" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-input" id="bookDescription" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pages</label>
                        <input type="number" class="form-input" id="bookPages">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Publisher</label>
                        <input type="text" class="form-input" id="bookPublisher">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Publication Year</label>
                        <input type="number" class="form-input" id="bookYear">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Book Cover Image</label>
                        <div class="file-upload" id="coverUpload">
                            <input type="file" id="bookCover" accept="image/*" onchange="handleCoverUpload(this)">
                            <i class="fas fa-image file-upload-icon"></i>
                            <span class="file-upload-text">Click to upload cover image</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">PDF File</label>
                        <div class="file-upload" id="pdfUpload">
                            <input type="file" id="bookPDF" accept="application/pdf" onchange="handlePDFUpload(this)">
                            <i class="fas fa-file-pdf file-upload-icon"></i>
                            <span class="file-upload-text">Click to upload PDF file</span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addBookModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveBook()">
                    <i class="fas fa-save"></i>
                    Save Book
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Book Modal -->
    <div id="editBookModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Book</h2>
                <button class="modal-close" onclick="closeModal('editBookModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editBookForm">
                    <input type="hidden" id="editBookId">
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" class="form-input" id="editBookTitle" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Author *</label>
                        <input type="text" class="form-input" id="editBookAuthor" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-input" id="editBookCategory" required>
                            <option value="">Select Category</option>
                            <option value="fiction">Fiction</option>
                            <option value="non-fiction">Non-Fiction</option>
                            <option value="science">Science</option>
                            <option value="history">History</option>
                            <option value="technology">Technology</option>
                            <option value="art">Art</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ISBN *</label>
                        <input type="text" class="form-input" id="editBookISBN" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-input" id="editBookDescription" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pages</label>
                        <input type="number" class="form-input" id="editBookPages">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Publisher</label>
                        <input type="text" class="form-input" id="editBookPublisher">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Publication Year</label>
                        <input type="number" class="form-input" id="editBookYear">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Book Cover Image</label>
                        <div class="file-upload" id="editCoverUpload">
                            <input type="file" id="editBookCover" accept="image/*" onchange="handleEditCoverUpload(this)">
                            <i class="fas fa-image file-upload-icon"></i>
                            <span class="file-upload-text">Click to upload new cover image</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">PDF File</label>
                        <div class="file-upload" id="editPdfUpload">
                            <input type="file" id="editBookPDF" accept="application/pdf" onchange="handleEditPDFUpload(this)">
                            <i class="fas fa-file-pdf file-upload-icon"></i>
                            <span class="file-upload-text">Click to upload new PDF file</span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editBookModal')">Cancel</button>
                <button class="btn btn-primary" onclick="updateBook()">
                    <i class="fas fa-save"></i>
                    Update Book
                </button>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New User</h2>
                <button class="modal-close" onclick="closeModal('addUserModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-input" id="userNameInput" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-input" id="userEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username *</label>
                        <input type="text" class="form-input" id="userUsername" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <input type="password" class="form-input" id="userPassword" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Role *</label>
                        <select class="form-input" id="userRole" required>
                            <option value="user">User</option>
                            <option value="admin">Administrator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status *</label>
                        <select class="form-input" id="userStatus" required>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addUserModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveUser()">
                    <i class="fas fa-save"></i>
                    Save User
                </button>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit User</h2>
                <button class="modal-close" onclick="closeModal('editUserModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editUserForm">
                    <input type="hidden" id="editUserId">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-input" id="editUserName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-input" id="editUserEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username *</label>
                        <input type="text" class="form-input" id="editUserUsername" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" id="editUserPassword" placeholder="Leave blank to keep current password">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Role *</label>
                        <select class="form-input" id="editUserRole" required>
                            <option value="user">User</option>
                            <option value="admin">Administrator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status *</label>
                        <select class="form-input" id="editUserStatus" required>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editUserModal')">Cancel</button>
                <button class="btn btn-primary" onclick="updateUser()">
                    <i class="fas fa-save"></i>
                    Update User
                </button>
            </div>
        </div>
    </div>

    <!-- Borrow Book Modal -->
    <div id="borrowBookModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Borrow Book</h2>
                <button class="modal-close" onclick="closeModal('borrowBookModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="borrowBookForm">
                    <div class="form-group">
                        <label class="form-label">User *</label>
                        <select class="form-input" id="borrowUser" required>
                            <option value="">Select User</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Book *</label>
                        <select class="form-input" id="borrowBook" required>
                            <option value="">Select Book</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Due Date *</label>
                        <input type="date" class="form-input" id="borrowDueDate" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('borrowBookModal')">Cancel</button>
                <button class="btn btn-primary" onclick="processBorrowing()">
                    <i class="fas fa-hand-holding"></i>
                    Borrow Book
                </button>
            </div>
        </div>
    </div>

    <!-- Return Book Modal -->
    <div id="returnBookModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Return Book</h2>
                <button class="modal-close" onclick="closeModal('returnBookModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="returnBookForm">
                    <div class="form-group">
                        <label class="form-label">Borrowing Record *</label>
                        <select class="form-input" id="returnBorrowing" required>
                            <option value="">Select Borrowing Record</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Return Date *</label>
                        <input type="date" class="form-input" id="returnDate" required>
                    </div>
                    <div class="form-group" id="fineSection" style="display: none;">
                        <label class="form-label">Fine Amount</label>
                        <input type="number" class="form-input" id="fineAmount" step="0.01" readonly>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('returnBookModal')">Cancel</button>
                <button class="btn btn-success" onclick="processReturn()">
                    <i class="fas fa-undo"></i>
                    Return Book
                </button>
            </div>
        </div>
    </div>

    <!-- Book Info Panel -->
    <div id="bookInfoPanel" class="info-panel">
        <div class="info-panel-header">
            <h3 class="info-panel-title">Book Information</h3>
            <button class="info-panel-close" onclick="closeBookInfoPanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="info-panel-body">
            <div class="info-panel-cover" id="infoPanelCover">
                <!-- Book cover will be loaded here -->
            </div>
            <h2 class="info-panel-book-title" id="infoPanelTitle"></h2>
            <p class="info-panel-book-author" id="infoPanelAuthor"></p>
            
            <div class="info-panel-meta">
                <div class="info-panel-meta-item">
                    <span class="info-panel-meta-label">Category</span>
                    <span class="info-panel-meta-value" id="infoPanelCategory"></span>
                </div>
                <div class="info-panel-meta-item">
                    <span class="info-panel-meta-label">ISBN</span>
                    <span class="info-panel-meta-value" id="infoPanelISBN"></span>
                </div>
                <div class="info-panel-meta-item">
                    <span class="info-panel-meta-label">Pages</span>
                    <span class="info-panel-meta-value" id="infoPanelPages"></span>
                </div>
                <div class="info-panel-meta-item">
                    <span class="info-panel-meta-label">Publisher</span>
                    <span class="info-panel-meta-value" id="infoPanelPublisher"></span>
                </div>
                <div class="info-panel-meta-item">
                    <span class="info-panel-meta-label">Year</span>
                    <span class="info-panel-meta-value" id="infoPanelYear"></span>
                </div>
                <div class="info-panel-meta-item">
                    <span class="info-panel-meta-label">Status</span>
                    <span class="info-panel-meta-value" id="infoPanelStatus"></span>
                </div>
            </div>
            
            <div class="info-panel-description" id="infoPanelDescription"></div>
            
            <div class="info-panel-actions">
                <button class="info-panel-action-btn primary" id="infoPanelBorrowBtn" onclick="borrowBookFromInfo()">
                    <i class="fas fa-hand-holding"></i>
                    Borrow Book
                </button>
                <button class="info-panel-action-btn success" id="infoPanelReadBtn" onclick="readBookFromInfo()">
                    <i class="fas fa-book-reader"></i>
                    Read Online
                </button>
                <button class="info-panel-action-btn secondary" onclick="closeBookInfoPanel()">
                    <i class="fas fa-home"></i>
                    Back to Home
                </button>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div id="overlay" class="overlay" onclick="closeBookInfoPanel()"></div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <div class="notification-icon">
            <i class="fas fa-check"></i>
        </div>
        <div class="notification-content">
            <div class="notification-title">Success</div>
            <div class="notification-message">Operation completed successfully</div>
        </div>
    </div>

    <script>
        // Set PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Data Storage
        let libraryData = {
            books: [],
            users: [],
            borrowedBooks: [],
            reservedBooks: [],
            fines: [],
            activities: [],
            settings: {
                libraryName: "Digital Library Pro",
                maxBooks: 5,
                borrowingPeriod: 14,
                finePerDay: 0.50,
                autoRenewal: true,
                emailNotifications: true
            }
        };

        let currentUser = null;
        let usageChart = null;
        let currentBookId = null;
        let pdfDoc = null;
        let currentPageNum = 1;
        let pageRendering = false;
        let pageNumPending = null;
        let scale = 1.5;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            checkAuthStatus();
            initializeEventListeners();
            checkDarkModePreference();
        });

        // Initialize data from localStorage or create sample data
        function initializeData() {
            const storedData = localStorage.getItem('libraryData');
            if (storedData) {
                libraryData = JSON.parse(storedData);
            } else {
                // Create sample data
                createSampleData();
                saveData();
            }
        }

        // Create sample data
        function createSampleData() {
            // Sample books
            libraryData.books = [
                {
                    id: 1,
                    title: "The Great Gatsby",
                    author: "F. Scott Fitzgerald",
                    category: "Fiction",
                    isbn: "978-0-7432-7356-5",
                    description: "A classic American novel",
                    pages: 180,
                    publisher: "Scribner",
                    year: 1925,
                    status: "available",
                    addedDate: new Date().toISOString(),
                    coverImage: "https://picsum.photos/seed/gatsby/300/400.jpg",
                    pdfFile: null
                },
                {
                    id: 2,
                    title: "To Kill a Mockingbird",
                    author: "Harper Lee",
                    category: "Fiction",
                    isbn: "978-0-06-112008-4",
                    description: "A gripping tale of racial injustice",
                    pages: 324,
                    publisher: "J.B. Lippincott & Co.",
                    year: 1960,
                    status: "available",
                    addedDate: new Date().toISOString(),
                    coverImage: "https://picsum.photos/seed/mockingbird/300/400.jpg",
                    pdfFile: null
                },
                {
                    id: 3,
                    title: "Sapiens",
                    author: "Yuval Noah Harari",
                    category: "Non-Fiction",
                    isbn: "978-0-06-231609-7",
                    description: "A brief history of humankind",
                    pages: 443,
                    publisher: "Harper",
                    year: 2015,
                    status: "available",
                    addedDate: new Date().toISOString(),
                    coverImage: "https://picsum.photos/seed/sapiens/300/400.jpg",
                    pdfFile: null
                },
                {
                    id: 4,
                    title: "1984",
                    author: "George Orwell",
                    category: "Fiction",
                    isbn: "978-0-452-28423-4",
                    description: "A dystopian social science fiction novel",
                    pages: 328,
                    publisher: "Secker & Warburg",
                    year: 1949,
                    status: "borrowed",
                    addedDate: new Date().toISOString(),
                    coverImage: "https://picsum.photos/seed/1984/300/400.jpg",
                    pdfFile: null
                },
                {
                    id: 5,
                    title: "The Hobbit",
                    author: "J.R.R. Tolkien",
                    category: "Fantasy",
                    isbn: "978-0-547-92822-7",
                    description: "A fantasy novel and children's book",
                    pages: 310,
                    publisher: "George Allen & Unwin",
                    year: 1937,
                    status: "available",
                    addedDate: new Date().toISOString(),
                    coverImage: "https://picsum.photos/seed/hobbit/300/400.jpg",
                    pdfFile: null
                }
            ];

            // Sample users
            libraryData.users = [
                {
                    id: 1,
                    name: "Admin User",
                    email: "admin@library.com",
                    username: "admin",
                    password: "admin123",
                    role: "admin",
                    status: "active",
                    memberSince: new Date().toISOString(),
                    profilePicture: "https://picsum.photos/seed/admin/300/300.jpg",
                    firstName: "Admin",
                    lastName: "User",
                    phone: "123-456-7890",
                    bio: "System administrator"
                },
                {
                    id: 2,
                    name: "John Doe",
                    email: "john@example.com",
                    username: "user",
                    password: "user123",
                    role: "user",
                    status: "active",
                    memberSince: new Date().toISOString(),
                    profilePicture: "https://picsum.photos/seed/john/300/300.jpg",
                    firstName: "John",
                    lastName: "Doe",
                    phone: "987-654-3210",
                    bio: "Book lover"
                },
                {
                    id: 3,
                    name: "Jane Smith",
                    email: "jane@example.com",
                    username: "janesmith",
                    password: "password123",
                    role: "user",
                    status: "active",
                    memberSince: new Date().toISOString(),
                    profilePicture: "https://picsum.photos/seed/jane/300/300.jpg",
                    firstName: "Jane",
                    lastName: "Smith",
                    phone: "555-123-4567",
                    bio: "Avid reader"
                }
            ];

            // Sample borrowed books
            const borrowDate = new Date();
            borrowDate.setDate(borrowDate.getDate() - 7);
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 7);

            libraryData.borrowedBooks = [
                {
                    id: 1,
                    bookId: 4,
                    userId: 2,
                    borrowDate: borrowDate.toISOString(),
                    dueDate: dueDate.toISOString(),
                    returnDate: null,
                    status: "borrowed"
                }
            ];

            // Sample activities
            libraryData.activities = [
                {
                    id: 1,
                    userId: 2,
                    userName: "John Doe",
                    action: "borrowed",
                    bookTitle: "1984",
                    date: borrowDate.toISOString(),
                    status: "active"
                },
                {
                    id: 2,
                    userId: 1,
                    userName: "Admin User",
                    action: "added",
                    bookTitle: "The Hobbit",
                    date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    status: "success"
                },
                {
                    id: 3,
                    userId: 3,
                    userName: "Jane Smith",
                    action: "registered",
                    bookTitle: "",
                    date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                    status: "success"
                }
            ];
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('libraryData', JSON.stringify(libraryData));
        }

        // Check authentication status
        function checkAuthStatus() {
            const rememberedUser = localStorage.getItem('rememberedUser');
            if (rememberedUser) {
                const user = libraryData.users.find(u => u.username === rememberedUser);
                if (user) {
                    login(user);
                }
            }
        }

        // Initialize event listeners
        function initializeEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
           
            // Register form
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
           
            // Password strength checker
            document.getElementById('registerPassword').addEventListener('input', checkPasswordStrength);
            document.getElementById('newPassword').addEventListener('input', checkNewPasswordStrength);
           
            // Search functionality
            document.querySelector('.search-input').addEventListener('input', handleSearch);
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
           
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
           
            // Clear previous errors
            clearErrors();
           
            // Validate
            let isValid = true;
            if (!email) {
                showError('loginEmailError');
                isValid = false;
            }
            if (!password) {
                showError('loginPasswordError');
                isValid = false;
            }
           
            if (!isValid) return;
           
            // Find user
            const user = libraryData.users.find(u =>
                (u.email === email || u.username === email) && u.password === password
            );
           
            if (user) {
                if (rememberMe) {
                    localStorage.setItem('rememberedUser', user.username);
                }
                login(user);
            } else {
                showNotification('Invalid credentials', 'error');
            }
        }

        // Handle registration
        function handleRegister(e) {
            e.preventDefault();
           
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const agreeTerms = document.getElementById('agreeTerms').checked;
           
            // Clear previous errors
            clearErrors();
           
            // Validate
            let isValid = true;
            if (!name) {
                showError('registerNameError');
                isValid = false;
            }
            if (!email || !isValidEmail(email)) {
                showError('registerEmailError');
                isValid = false;
            }
            if (!username) {
                showError('registerUsernameError');
                isValid = false;
            }
            if (password.length < 8) {
                showError('registerPasswordError');
                isValid = false;
            }
            if (password !== confirmPassword) {
                showError('registerConfirmPasswordError');
                isValid = false;
            }
            if (!agreeTerms) {
                showNotification('Please agree to the terms and conditions', 'error');
                isValid = false;
            }
           
            if (!isValid) return;
           
            // Check if user already exists
            if (libraryData.users.find(u => u.email === email || u.username === username)) {
                showNotification('User already exists', 'error');
                return;
            }
           
            // Create new user
            const newUser = {
                id: libraryData.users.length + 1,
                name: name,
                email: email,
                username: username,
                password: password,
                role: 'user',
                status: 'active',
                memberSince: new Date().toISOString(),
                profilePicture: "https://picsum.photos/seed/" + username + "/300/300.jpg",
                firstName: name.split(' ')[0],
                lastName: name.split(' ').slice(1).join(' '),
                phone: "",
                bio: ""
            };
           
            libraryData.users.push(newUser);
            saveData();
           
            showNotification('Account created successfully! Please login.', 'success');
            showLogin();
        }

        // Check password strength
        function checkPasswordStrength() {
            const password = document.getElementById('registerPassword').value;
            const strengthBar = document.getElementById('passwordStrengthBar');
           
            let strength = 0;
            if (password.length >= 8) strength++;
            if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;
           
            strengthBar.className = 'password-strength-bar';
            if (strength === 1) strengthBar.classList.add('strength-weak');
            else if (strength === 2) strengthBar.classList.add('strength-medium');
            else if (strength >= 3) strengthBar.classList.add('strength-strong');
        }

        // Check new password strength
        function checkNewPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthBar = document.getElementById('newPasswordStrengthBar');
           
            let strength = 0;
            if (password.length >= 8) strength++;
            if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;
           
            strengthBar.className = 'password-strength-bar';
            if (strength === 1) strengthBar.classList.add('strength-weak');
            else if (strength === 2) strengthBar.classList.add('strength-medium');
            else if (strength >= 3) strengthBar.classList.add('strength-strong');
        }

        // Login user
        function login(user) {
            currentUser = user;
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
           
            // Update user info in header
            document.getElementById('userName').textContent = user.name;
            document.getElementById('userRole').textContent = user.role === 'admin' ? 'Administrator' : 'Member';
            
            // Update user avatar
            const userAvatar = document.getElementById('userAvatar');
            if (user.profilePicture) {
                userAvatar.innerHTML = `<img src="${user.profilePicture}" alt="${user.name}">`;
            } else {
                userAvatar.textContent = user.name.charAt(0).toUpperCase();
            }
           
            // Show/hide admin features
            if (user.role === 'admin') {
                document.getElementById('usersMenuItem').style.display = 'flex';
                document.getElementById('borrowingMenuItem').style.display = 'flex';
                document.getElementById('reservationsMenuItem').style.display = 'flex';
                document.getElementById('adminMenuSection').style.display = 'block';
                document.getElementById('systemMenuSection').style.display = 'block';
                document.getElementById('addBookBtn').style.display = 'inline-flex';
                document.getElementById('importBooksBtn').style.display = 'inline-flex';
                document.getElementById('exportBooksBtn').style.display = 'inline-flex';
            }
           
            // Load dashboard
            loadDashboard();
           
            showNotification(`Welcome back, ${user.name}!`, 'success');
        }

        // Logout user
        function logout() {
            currentUser = null;
            localStorage.removeItem('rememberedUser');
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            showNotification('Logged out successfully', 'info');
        }

        // Show login form
        function showLogin() {
            document.getElementById('loginCard').style.display = 'flex';
            document.getElementById('registerCard').style.display = 'none';
        }

        // Show register form
        function showRegister() {
            document.getElementById('loginCard').style.display = 'none';
            document.getElementById('registerCard').style.display = 'flex';
        }

        // Load dashboard
        function loadDashboard() {
            updateStats();
            loadActivities();
            initializeCharts();
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalBooksStat').textContent = libraryData.books.length;
            document.getElementById('totalUsersStat').textContent = libraryData.users.filter(u => u.role !== 'admin').length;
            document.getElementById('borrowedBooksStat').textContent = libraryData.borrowedBooks.filter(b => b.status === 'borrowed').length;
            document.getElementById('overdueBooksStat').textContent = libraryData.borrowedBooks.filter(b => 
                b.status === 'borrowed' && new Date(b.dueDate) < new Date()
            ).length;
           
            document.getElementById('userCountBadge').textContent = libraryData.users.filter(u => u.role !== 'admin').length;
        }

        // Initialize charts
        function initializeCharts() {
            const ctx = document.getElementById('usageChart').getContext('2d');
            
            if (usageChart) {
                usageChart.destroy();
            }
            
            usageChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Books Borrowed',
                        data: [65, 59, 80, 81, 56, 72],
                        backgroundColor: 'rgba(59, 130, 246, 0.5)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }, {
                        label: 'New Users',
                        data: [28, 48, 40, 35, 46, 30],
                        backgroundColor: 'rgba(16, 185, 129, 0.5)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Load activities
        function loadActivities() {
            const tbody = document.getElementById('activitiesTable');
            tbody.innerHTML = '';
           
            const recentActivities = libraryData.activities.slice(-5).reverse();
           
            recentActivities.forEach(activity => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${activity.userName}</td>
                    <td>${activity.action}</td>
                    <td>${activity.bookTitle || 'N/A'}</td>
                    <td>${new Date(activity.date).toLocaleDateString()}</td>
                    <td><span class="table-badge badge-${activity.status === 'active' ? 'success' : 'info'}">${activity.status}</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Show section
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.dashboard').forEach(s => {
                s.style.display = 'none';
            });
           
            // Show selected section
            const sectionElement = document.getElementById(section + 'Section');
            if (sectionElement) {
                sectionElement.style.display = 'block';
            }
           
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
           
            // Load section data
            if (section === 'books') {
                loadBooks();
            } else if (section === 'users') {
                loadUsers();
            } else if (section === 'borrowing') {
                loadBorrowings();
            } else if (section === 'settings') {
                loadSettings();
            } else if (section === 'profile') {
                loadProfile();
            }
        }

        // Load books grid
        function loadBooks() {
            const grid = document.getElementById('booksGrid');
            grid.innerHTML = '';
           
            libraryData.books.forEach(book => {
                const bookCard = document.createElement('div');
                bookCard.className = 'book-card';
                
                const coverImage = book.coverImage ? 
                    `<img src="${book.coverImage}" alt="${book.title}">` :
                    `<div class="book-cover-placeholder">
                        <i class="fas fa-book"></i>
                        <span>No Cover</span>
                    </div>`;
                
                // Add admin edit buttons
                const adminActions = currentUser && currentUser.role === 'admin' ? 
                    `<div class="book-card-actions">
                        <button class="book-card-action-btn edit" onclick="showEditBookModal(${book.id})" title="Edit Book">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="book-card-action-btn delete" onclick="deleteBook(${book.id})" title="Delete Book">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>` : '';
                
                bookCard.innerHTML = `
                    <div class="book-cover">
                        ${coverImage}
                        ${adminActions}
                        <div class="book-info-overlay">
                            <button class="info-btn" onclick="showBookInfo(${book.id})">
                                <i class="fas fa-info-circle"></i>
                                Info
                            </button>
                        </div>
                    </div>
                    <div class="book-info">
                        <h3 class="book-title">${book.title}</h3>
                        <p class="book-author">${book.author}</p>
                        <span class="book-status ${book.status}">${book.status}</span>
                    </div>
                `;
                grid.appendChild(bookCard);
            });
        }

        // Load users table
        function loadUsers() {
            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = '';
           
            libraryData.users.forEach(user => {
                // Don't show current user in the list
                if (user.id === currentUser.id) return;
                
                const actionButtons = currentUser.role === 'admin' ? 
                    `<div class="table-actions-btn">
                        <button class="action-btn edit" onclick="showEditUserModal(${user.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteUser(${user.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>` :
                    `<div class="table-actions-btn">
                        <button class="action-btn view" onclick="viewUser(${user.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>`;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.role}</td>
                    <td>${new Date(user.memberSince).toLocaleDateString()}</td>
                    <td><span class="table-badge badge-${user.status === 'active' ? 'success' : 'danger'}">${user.status}</span></td>
                    <td>${actionButtons}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Load borrowings table
        function loadBorrowings() {
            const tbody = document.getElementById('borrowingsTable');
            tbody.innerHTML = '';
           
            libraryData.borrowedBooks.forEach(borrowing => {
                if (borrowing.status !== 'borrowed') return;
                
                const book = libraryData.books.find(b => b.id === borrowing.bookId);
                const user = libraryData.users.find(u => u.id === borrowing.userId);
                const isOverdue = new Date(borrowing.dueDate) < new Date();
                
                const actionButtons = currentUser.role === 'admin' ? 
                    `<div class="table-actions-btn">
                        <button class="action-btn edit" onclick="extendDueDate(${borrowing.id})">
                            <i class="fas fa-calendar-plus"></i>
                        </button>
                        <button class="action-btn delete" onclick="processReturnById(${borrowing.id})">
                            <i class="fas fa-undo"></i>
                        </button>
                    </div>` :
                    `<div class="table-actions-btn">
                        <button class="action-btn view" onclick="viewBorrowing(${borrowing.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>`;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${borrowing.id}</td>
                    <td>${user.name}</td>
                    <td>${book.title}</td>
                    <td>${new Date(borrowing.borrowDate).toLocaleDateString()}</td>
                    <td><span class="${isOverdue ? 'text-danger' : ''}">${new Date(borrowing.dueDate).toLocaleDateString()}</span></td>
                    <td><span class="table-badge badge-${isOverdue ? 'danger' : 'success'}">${isOverdue ? 'Overdue' : 'Active'}</span></td>
                    <td>${actionButtons}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Load settings
        function loadSettings() {
            if (currentUser.role !== 'admin') {
                document.getElementById('settingsRestricted').style.display = 'flex';
                document.getElementById('settingsContent').style.display = 'none';
                return;
            }
            
            document.getElementById('settingsRestricted').style.display = 'none';
            document.getElementById('settingsContent').style.display = 'block';
            
            document.getElementById('libraryName').value = libraryData.settings.libraryName;
            document.getElementById('maxBooks').value = libraryData.settings.maxBooks;
            document.getElementById('borrowingPeriod').value = libraryData.settings.borrowingPeriod;
            document.getElementById('finePerDay').value = libraryData.settings.finePerDay;
            document.getElementById('autoRenewal').checked = libraryData.settings.autoRenewal;
            document.getElementById('emailNotifications').checked = libraryData.settings.emailNotifications;
        }

        // Load profile
        function loadProfile() {
            // Update profile information
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profileRole').textContent = currentUser.role === 'admin' ? 'Administrator' : 'Member';
            
            // Update profile avatar
            if (currentUser.profilePicture) {
                document.getElementById('profileAvatarImg').src = currentUser.profilePicture;
            }
            
            // Update profile statistics
            const borrowedBooks = libraryData.borrowedBooks.filter(b => b.userId === currentUser.id && b.status === 'borrowed').length;
            const reservedBooks = libraryData.reservedBooks.filter(r => r.userId === currentUser.id).length;
            const fines = libraryData.fines.filter(f => f.userId === currentUser.id && f.status === 'unpaid')
                .reduce((total, fine) => total + fine.amount, 0);
            
            document.getElementById('profileBooksBorrowed').textContent = borrowedBooks;
            document.getElementById('profileBooksReserved').textContent = reservedBooks;
            document.getElementById('profileFines').textContent = '$' + fines.toFixed(2);
            
            // Update personal information form
            document.getElementById('profileFirstName').value = currentUser.firstName || '';
            document.getElementById('profileLastName').value = currentUser.lastName || '';
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('profileUsername').value = currentUser.username;
            document.getElementById('profilePhone').value = currentUser.phone || '';
            document.getElementById('profileBio').value = currentUser.bio || '';
            
            // Load user activities
            loadProfileActivities();
        }

        // Load profile activities
        function loadProfileActivities() {
            const tbody = document.getElementById('profileActivityTable');
            tbody.innerHTML = '';
            
            const userActivities = libraryData.activities
                .filter(a => a.userId === currentUser.id)
                .slice(-10)
                .reverse();
            
            if (userActivities.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center;">No activities found</td></tr>';
                return;
            }
            
            userActivities.forEach(activity => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${activity.action}</td>
                    <td>${activity.bookTitle || 'N/A'}</td>
                    <td>${new Date(activity.date).toLocaleDateString()}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Show profile tab
        function showProfileTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.profile-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.profile-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Add active class to clicked button
            event.currentTarget.classList.add('active');
        }

        // Handle profile avatar upload
        function handleProfileAvatarUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const imageUrl = e.target.result;
                    
                    // Update profile picture in UI
                    document.getElementById('profileAvatarImg').src = imageUrl;
                    
                    // Update user avatar in header
                    const userAvatar = document.getElementById('userAvatar');
                    userAvatar.innerHTML = `<img src="${imageUrl}" alt="${currentUser.name}">`;
                    
                    // Save to data model
                    currentUser.profilePicture = imageUrl;
                    saveData();
                    
                    showNotification('Profile picture updated successfully', 'success');
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Save profile personal information
        function saveProfilePersonalInfo() {
            const firstName = document.getElementById('profileFirstName').value;
            const lastName = document.getElementById('profileLastName').value;
            const email = document.getElementById('profileEmail').value;
            const username = document.getElementById('profileUsername').value;
            const phone = document.getElementById('profilePhone').value;
            const bio = document.getElementById('profileBio').value;
            
            // Update user data
            currentUser.firstName = firstName;
            currentUser.lastName = lastName;
            currentUser.name = `${firstName} ${lastName}`;
            currentUser.email = email;
            currentUser.username = username;
            currentUser.phone = phone;
            currentUser.bio = bio;
            
            // Update UI
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('userName').textContent = currentUser.name;
            
            // Save to storage
            saveData();
            
            showNotification('Profile information updated successfully', 'success');
        }

        // Change password
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            
            // Validate
            if (!currentPassword || !newPassword || !confirmNewPassword) {
                showNotification('Please fill all password fields', 'error');
                return;
            }
            
            if (currentPassword !== currentUser.password) {
                showNotification('Current password is incorrect', 'error');
                return;
            }
            
            if (newPassword.length < 8) {
                showNotification('New password must be at least 8 characters', 'error');
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                showNotification('New passwords do not match', 'error');
                return;
            }
            
            // Update password
            currentUser.password = newPassword;
            saveData();
            
            // Clear form
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmNewPassword').value = '';
            
            showNotification('Password changed successfully', 'success');
        }

        // Save profile preferences
        function saveProfilePreferences() {
            const language = document.getElementById('profileLanguage').value;
            const theme = document.getElementById('profileTheme').value;
            const emailNotifications = document.getElementById('emailNotifications').checked;
            const pushNotifications = document.getElementById('pushNotifications').checked;
            
            // Save preferences
            currentUser.preferences = {
                language: language,
                theme: theme,
                emailNotifications: emailNotifications,
                pushNotifications: pushNotifications
            };
            
            // Apply theme
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                document.getElementById('darkModeIcon').className = 'fas fa-sun';
            } else if (theme === 'light') {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
                document.getElementById('darkModeIcon').className = 'fas fa-moon';
            } else {
                // Auto theme - check system preference
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    document.getElementById('darkModeIcon').className = 'fas fa-sun';
                } else {
                    document.documentElement.removeAttribute('data-theme');
                    document.getElementById('darkModeIcon').className = 'fas fa-moon';
                }
                localStorage.setItem('theme', 'auto');
            }
            
            saveData();
            
            showNotification('Preferences saved successfully', 'success');
        }

        // Change theme
        function changeTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                document.getElementById('darkModeIcon').className = 'fas fa-sun';
            } else if (theme === 'light') {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
                document.getElementById('darkModeIcon').className = 'fas fa-moon';
            } else {
                // Auto theme - check system preference
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    document.getElementById('darkModeIcon').className = 'fas fa-sun';
                } else {
                    document.documentElement.removeAttribute('data-theme');
                    document.getElementById('darkModeIcon').className = 'fas fa-moon';
                }
                localStorage.setItem('theme', 'auto');
            }
        }

        // Check dark mode preference
        function checkDarkModePreference() {
            const savedTheme = localStorage.getItem('theme');
            
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('darkModeIcon').className = 'fas fa-sun';
            } else if (savedTheme === 'light') {
                document.documentElement.removeAttribute('data-theme');
                document.getElementById('darkModeIcon').className = 'fas fa-moon';
            } else {
                // Auto theme - check system preference
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    document.getElementById('darkModeIcon').className = 'fas fa-sun';
                } else {
                    document.documentElement.removeAttribute('data-theme');
                    document.getElementById('darkModeIcon').className = 'fas fa-moon';
                }
            }
        }

        // Toggle dark mode
        function toggleDarkMode() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            
            if (currentTheme === 'dark') {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
                document.getElementById('darkModeIcon').className = 'fas fa-moon';
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                document.getElementById('darkModeIcon').className = 'fas fa-sun';
            }
        }

        // Show add book modal
        function showAddBookModal() {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to add books', 'error');
                return;
            }
            document.getElementById('addBookModal').classList.add('active');
        }

        // Show edit book modal
        function showEditBookModal(bookId) {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to edit books', 'error');
                return;
            }
            
            const book = libraryData.books.find(b => b.id === bookId);
            if (!book) return;
            
            // Populate form with book data
            document.getElementById('editBookId').value = book.id;
            document.getElementById('editBookTitle').value = book.title;
            document.getElementById('editBookAuthor').value = book.author;
            document.getElementById('editBookCategory').value = book.category;
            document.getElementById('editBookISBN').value = book.isbn;
            document.getElementById('editBookDescription').value = book.description || '';
            document.getElementById('editBookPages').value = book.pages || '';
            document.getElementById('editBookPublisher').value = book.publisher || '';
            document.getElementById('editBookYear').value = book.year || '';
            
            document.getElementById('editBookModal').classList.add('active');
        }

        // Show add user modal
        function showAddUserModal() {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to add users', 'error');
                return;
            }
            document.getElementById('addUserModal').classList.add('active');
        }

        // Show edit user modal
        function showEditUserModal(userId) {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to edit users', 'error');
                return;
            }
            
            const user = libraryData.users.find(u => u.id === userId);
            if (!user) return;
            
            // Populate form with user data
            document.getElementById('editUserId').value = user.id;
            document.getElementById('editUserName').value = user.name;
            document.getElementById('editUserEmail').value = user.email;
            document.getElementById('editUserUsername').value = user.username;
            document.getElementById('editUserRole').value = user.role;
            document.getElementById('editUserStatus').value = user.status;
            
            document.getElementById('editUserModal').classList.add('active');
        }

        // Show borrow book modal
        function showBorrowBookModal() {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to borrow books', 'error');
                return;
            }
            
            const userSelect = document.getElementById('borrowUser');
            userSelect.innerHTML = '<option value="">Select User</option>';
            
            libraryData.users.filter(u => u.role === 'user' && u.status === 'active').forEach(user => {
                const option = document.createElement('option');
                option.value = user.id;
                option.textContent = user.name;
                userSelect.appendChild(option);
            });
            
            const bookSelect = document.getElementById('borrowBook');
            bookSelect.innerHTML = '<option value="">Select Book</option>';
            
            libraryData.books.filter(b => b.status === 'available').forEach(book => {
                const option = document.createElement('option');
                option.value = book.id;
                option.textContent = `${book.title} by ${book.author}`;
                bookSelect.appendChild(option);
            });
            
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + libraryData.settings.borrowingPeriod);
            document.getElementById('borrowDueDate').value = dueDate.toISOString().split('T')[0];
            
            document.getElementById('borrowBookModal').classList.add('active');
        }

        // Show return book modal
        function showReturnBookModal() {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to return books', 'error');
                return;
            }
            
            const borrowingSelect = document.getElementById('returnBorrowing');
            borrowingSelect.innerHTML = '<option value="">Select Borrowing Record</option>';
            
            libraryData.borrowedBooks.filter(b => b.status === 'borrowed').forEach(borrowing => {
                const book = libraryData.books.find(b => b.id === borrowing.bookId);
                const user = libraryData.users.find(u => u.id === borrowing.userId);
                const option = document.createElement('option');
                option.value = borrowing.id;
                option.textContent = `${user.name} - ${book.title}`;
                borrowingSelect.appendChild(option);
            });
            
            document.getElementById('returnDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('fineSection').style.display = 'none';
            
            document.getElementById('returnBookModal').classList.add('active');
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Handle cover image upload
        function handleCoverUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const uploadElement = document.getElementById('coverUpload');
                    uploadElement.classList.add('has-file');
                    uploadElement.querySelector('.file-upload-text').textContent = input.files[0].name;
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Handle PDF upload
        function handlePDFUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const uploadElement = document.getElementById('pdfUpload');
                    uploadElement.classList.add('has-file');
                    uploadElement.querySelector('.file-upload-text').textContent = input.files[0].name;
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Handle edit cover upload
        function handleEditCoverUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const uploadElement = document.getElementById('editCoverUpload');
                    uploadElement.classList.add('has-file');
                    uploadElement.querySelector('.file-upload-text').textContent = input.files[0].name;
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Handle edit PDF upload
        function handleEditPDFUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const uploadElement = document.getElementById('editPdfUpload');
                    uploadElement.classList.add('has-file');
                    uploadElement.querySelector('.file-upload-text').textContent = input.files[0].name;
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Save book
        function saveBook() {
            const title = document.getElementById('bookTitle').value;
            const author = document.getElementById('bookAuthor').value;
            const category = document.getElementById('bookCategory').value;
            const isbn = document.getElementById('bookISBN').value;
            const description = document.getElementById('bookDescription').value;
            const pages = parseInt(document.getElementById('bookPages').value) || 0;
            const publisher = document.getElementById('bookPublisher').value;
            const year = parseInt(document.getElementById('bookYear').value) || new Date().getFullYear();
            
            // Get uploaded files
            const coverFile = document.getElementById('bookCover').files[0];
            const pdfFile = document.getElementById('bookPDF').files[0];
            
            // Process cover image
            let coverImage = null;
            if (coverFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    coverImage = e.target.result;
                };
                reader.readAsDataURL(coverFile);
            }
            
            // Process PDF file
            let pdfData = null;
            if (pdfFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    pdfData = e.target.result;
                };
                reader.readAsDataURL(pdfFile);
            }
            
            // Create book object
            const book = {
                id: libraryData.books.length + 1,
                title: title,
                author: author,
                category: category,
                isbn: isbn,
                description: description,
                pages: pages,
                publisher: publisher,
                year: year,
                status: 'available',
                addedDate: new Date().toISOString(),
                coverImage: coverImage,
                pdfFile: pdfData
            };
            
            // Add book to library
            libraryData.books.push(book);
            saveData();
            loadBooks();
            updateStats();
            closeModal('addBookModal');
            showNotification('Book added successfully', 'success');
            
            // Add activity
            addActivity(currentUser.name, 'added', book.title, 'success');
        }

        // Update book
        function updateBook() {
            const bookId = parseInt(document.getElementById('editBookId').value);
            const book = libraryData.books.find(b => b.id === bookId);
            
            if (!book) return;
            
            // Update book properties
            book.title = document.getElementById('editBookTitle').value;
            book.author = document.getElementById('editBookAuthor').value;
            book.category = document.getElementById('editBookCategory').value;
            book.isbn = document.getElementById('editBookISBN').value;
            book.description = document.getElementById('editBookDescription').value;
            book.pages = parseInt(document.getElementById('editBookPages').value) || 0;
            book.publisher = document.getElementById('editBookPublisher').value;
            book.year = parseInt(document.getElementById('editBookYear').value) || new Date().getFullYear();
            
            // Handle new cover image if uploaded
            const coverFile = document.getElementById('editBookCover').files[0];
            if (coverFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    book.coverImage = e.target.result;
                    saveData();
                    loadBooks();
                };
                reader.readAsDataURL(coverFile);
            }
            
            // Handle new PDF if uploaded
            const pdfFile = document.getElementById('editBookPDF').files[0];
            if (pdfFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    book.pdfFile = e.target.result;
                    saveData();
                    loadBooks();
                };
                reader.readAsDataURL(pdfFile);
            }
            
            saveData();
            loadBooks();
            closeModal('editBookModal');
            showNotification('Book updated successfully', 'success');
            
            // Add activity
            addActivity(currentUser.name, 'updated', book.title, 'success');
        }

        // Save user
        function saveUser() {
            const user = {
                id: libraryData.users.length + 1,
                name: document.getElementById('userNameInput').value,
                email: document.getElementById('userEmail').value,
                username: document.getElementById('userUsername').value,
                password: document.getElementById('userPassword').value,
                role: document.getElementById('userRole').value,
                status: document.getElementById('userStatus').value,
                memberSince: new Date().toISOString(),
                profilePicture: "https://picsum.photos/seed/" + document.getElementById('userUsername').value + "/300/300.jpg",
                firstName: document.getElementById('userNameInput').value.split(' ')[0],
                lastName: document.getElementById('userNameInput').value.split(' ').slice(1).join(' '),
                phone: "",
                bio: ""
            };
           
            libraryData.users.push(user);
            saveData();
            loadUsers();
            updateStats();
            closeModal('addUserModal');
            showNotification('User added successfully', 'success');
           
            // Add activity
            addActivity(currentUser.name, 'added', `user ${user.name}`, 'success');
        }

        // Update user
        function updateUser() {
            const userId = parseInt(document.getElementById('editUserId').value);
            const user = libraryData.users.find(u => u.id === userId);
            
            if (!user) return;
            
            // Update user properties
            user.name = document.getElementById('editUserName').value;
            user.email = document.getElementById('editUserEmail').value;
            user.username = document.getElementById('editUserUsername').value;
            user.role = document.getElementById('editUserRole').value;
            user.status = document.getElementById('editUserStatus').value;
            
            // Update password if provided
            const newPassword = document.getElementById('editUserPassword').value;
            if (newPassword) {
                user.password = newPassword;
            }
            
            // Update name components
            user.firstName = user.name.split(' ')[0];
            user.lastName = user.name.split(' ').slice(1).join(' ');
            
            saveData();
            loadUsers();
            closeModal('editUserModal');
            showNotification('User updated successfully', 'success');
            
            // Add activity
            addActivity(currentUser.name, 'updated', `user ${user.name}`, 'success');
        }

        // Process borrowing
        function processBorrowing() {
            const userId = parseInt(document.getElementById('borrowUser').value);
            const bookId = parseInt(document.getElementById('borrowBook').value);
            const dueDate = document.getElementById('borrowDueDate').value;
            
            if (!userId || !bookId || !dueDate) {
                showNotification('Please fill all required fields', 'error');
                return;
            }
            
            const borrowing = {
                id: libraryData.borrowedBooks.length + 1,
                bookId: bookId,
                userId: userId,
                borrowDate: new Date().toISOString(),
                dueDate: new Date(dueDate).toISOString(),
                returnDate: null,
                status: 'borrowed'
            };
            
            // Update book status
            const book = libraryData.books.find(b => b.id === bookId);
            book.status = 'borrowed';
            
            libraryData.borrowedBooks.push(borrowing);
            saveData();
            loadBorrowings();
            updateStats();
            closeModal('borrowBookModal');
            showNotification('Book borrowed successfully', 'success');
            
            // Add activity
            const user = libraryData.users.find(u => u.id === userId);
            addActivity(user.name, 'borrowed', book.title, 'active');
        }

        // Process return
        function processReturn() {
            const borrowingId = parseInt(document.getElementById('returnBorrowing').value);
            const returnDate = document.getElementById('returnDate').value;
            
            if (!borrowingId || !returnDate) {
                showNotification('Please fill all required fields', 'error');
                return;
            }
            
            const borrowing = libraryData.borrowedBooks.find(b => b.id === borrowingId);
            borrowing.returnDate = new Date(returnDate).toISOString();
            borrowing.status = 'returned';
            
            // Update book status
            const book = libraryData.books.find(b => b.id === borrowing.bookId);
            book.status = 'available';
            
            // Calculate fine if overdue
            const dueDate = new Date(borrowing.dueDate);
            const actualReturnDate = new Date(returnDate);
            const daysOverdue = Math.max(0, Math.ceil((actualReturnDate - dueDate) / (1000 * 60 * 60 * 24)));
            
            if (daysOverdue > 0) {
                const fineAmount = daysOverdue * libraryData.settings.finePerDay;
                
                const fine = {
                    id: libraryData.fines.length + 1,
                    userId: borrowing.userId,
                    borrowingId: borrowing.id,
                    amount: fineAmount,
                    status: 'unpaid',
                    issuedDate: new Date().toISOString()
                };
                
                libraryData.fines.push(fine);
                showNotification(`Book returned with a fine of $${fineAmount.toFixed(2)} for ${daysOverdue} day(s) overdue`, 'warning');
            } else {
                showNotification('Book returned successfully', 'success');
            }
            
            saveData();
            loadBorrowings();
            updateStats();
            closeModal('returnBookModal');
            
            // Add activity
            const user = libraryData.users.find(u => u.id === borrowing.userId);
            addActivity(user.name, 'returned', book.title, 'success');
        }

        // Save settings
        function saveSettings() {
            libraryData.settings.libraryName = document.getElementById('libraryName').value;
            libraryData.settings.maxBooks = parseInt(document.getElementById('maxBooks').value);
            libraryData.settings.borrowingPeriod = parseInt(document.getElementById('borrowingPeriod').value);
            libraryData.settings.finePerDay = parseFloat(document.getElementById('finePerDay').value);
            libraryData.settings.autoRenewal = document.getElementById('autoRenewal').checked;
            libraryData.settings.emailNotifications = document.getElementById('emailNotifications').checked;
            
            saveData();
            showNotification('Settings saved successfully', 'success');
        }

        // Delete book
        function deleteBook(bookId) {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to delete books', 'error');
                return;
            }
            
            if (confirm('Are you sure you want to delete this book?')) {
                const book = libraryData.books.find(b => b.id === bookId);
                libraryData.books = libraryData.books.filter(b => b.id !== bookId);
                saveData();
                loadBooks();
                updateStats();
                showNotification('Book deleted successfully', 'success');
               
                // Add activity
                addActivity(currentUser.name, 'deleted', book.title, 'warning');
            }
        }

        // Delete user
        function deleteUser(userId) {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to delete users', 'error');
                return;
            }
            
            if (confirm('Are you sure you want to delete this user?')) {
                const user = libraryData.users.find(u => u.id === userId);
                libraryData.users = libraryData.users.filter(u => u.id !== userId);
                saveData();
                loadUsers();
                updateStats();
                showNotification('User deleted successfully', 'success');
               
                // Add activity
                addActivity(currentUser.name, 'deleted', `user ${user.name}`, 'warning');
            }
        }

        // Add activity
        function addActivity(userName, action, bookTitle, status) {
            const activity = {
                id: libraryData.activities.length + 1,
                userId: currentUser.id,
                userName: userName,
                action: action,
                bookTitle: bookTitle,
                date: new Date().toISOString(),
                status: status
            };
           
            libraryData.activities.push(activity);
            saveData();
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const icon = notification.querySelector('.notification-icon i');
            const title = notification.querySelector('.notification-title');
            const msg = notification.querySelector('.notification-message');
           
            // Update content
            notification.className = `notification ${type}`;
            if (type === 'success') {
                icon.className = 'fas fa-check';
                title.textContent = 'Success';
            } else if (type === 'error') {
                icon.className = 'fas fa-times';
                title.textContent = 'Error';
            } else if (type === 'warning') {
                icon.className = 'fas fa-exclamation';
                title.textContent = 'Warning';
            } else {
                icon.className = 'fas fa-info';
                title.textContent = 'Info';
            }
            msg.textContent = message;
           
            // Show notification
            notification.classList.add('show');
           
            // Hide after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Handle search
        function handleSearch() {
            const searchTerm = document.querySelector('.search-input').value.toLowerCase();
           
            // Search in books
            if (document.getElementById('booksSection').style.display !== 'none') {
                const books = document.querySelectorAll('.book-card');
                books.forEach(book => {
                    const text = book.textContent.toLowerCase();
                    book.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            }
           
            // Search in users
            if (document.getElementById('usersSection').style.display !== 'none') {
                const users = document.querySelectorAll('#usersTable tr');
                users.forEach(user => {
                    const text = user.textContent.toLowerCase();
                    user.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            }
        }

        // Utility functions
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function showError(errorId) {
            document.getElementById(errorId).style.display = 'block';
            document.getElementById(errorId.replace('Error', '')).classList.add('error');
        }

        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
            });
            document.querySelectorAll('.form-input').forEach(input => {
                input.classList.remove('error');
            });
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        function refreshActivities() {
            loadActivities();
            showNotification('Activities refreshed', 'info');
        }

        function exportBooks() {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to export data', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(libraryData.books, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
           
            const exportFileDefaultName = 'books.json';
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
           
            showNotification('Books exported successfully', 'success');
        }

        function exportUsers() {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to export data', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(libraryData.users, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
           
            const exportFileDefaultName = 'users.json';
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
           
            showNotification('Users exported successfully', 'success');
        }

        function importBooks() {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to import data', 'error');
                return;
            }
            showNotification('Import feature coming soon', 'info');
        }

        function showNotifications() {
            showNotification('No new notifications', 'info');
        }

        function showUserMenu() {
            if (confirm('Do you want to logout?')) {
                logout();
            }
        }

        // Edit book function
        function editBook(id) {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to edit books', 'error');
                return;
            }
            showEditBookModal(id);
        }

        // Edit user function
        function editUser(id) {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to edit users', 'error');
                return;
            }
            showEditUserModal(id);
        }

        // View user function (placeholder)
        function viewUser(id) {
            showNotification('View user feature coming soon', 'info');
        }

        // Extend due date function (placeholder)
        function extendDueDate(id) {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to extend due dates', 'error');
                return;
            }
            showNotification('Extend due date feature coming soon', 'info');
        }

        // Process return by ID function (placeholder)
        function processReturnById(id) {
            if (currentUser.role !== 'admin') {
                showNotification('You need admin privileges to return books', 'error');
                return;
            }
            showNotification('Return book feature coming soon', 'info');
        }

        // View borrowing function (placeholder)
        function viewBorrowing(id) {
            showNotification('View borrowing feature coming soon', 'info');
        }

        // Show book info panel
        function showBookInfo(bookId) {
            currentBookId = bookId;
            const book = libraryData.books.find(b => b.id === bookId);
            
            if (!book) return;
            
            // Update book info panel content
            document.getElementById('infoPanelTitle').textContent = book.title;
            document.getElementById('infoPanelAuthor').textContent = `by ${book.author}`;
            document.getElementById('infoPanelCategory').textContent = book.category;
            document.getElementById('infoPanelISBN').textContent = book.isbn;
            document.getElementById('infoPanelPages').textContent = book.pages || 'N/A';
            document.getElementById('infoPanelPublisher').textContent = book.publisher || 'N/A';
            document.getElementById('infoPanelYear').textContent = book.year || 'N/A';
            document.getElementById('infoPanelDescription').textContent = book.description || 'No description available.';
            
            // Update status
            const statusElement = document.getElementById('infoPanelStatus');
            statusElement.textContent = book.status;
            statusElement.className = `info-panel-meta-value ${book.status}`;
            
            // Update book cover
            const coverContainer = document.getElementById('infoPanelCover');
            if (book.coverImage) {
                coverContainer.innerHTML = `<img src="${book.coverImage}" alt="${book.title}">`;
            } else {
                coverContainer.innerHTML = `
                    <div class="book-cover-placeholder" style="height: 100%;">
                        <i class="fas fa-book" style="font-size: 3rem;"></i>
                        <span>No Cover Available</span>
                    </div>
                `;
            }
            
            // Update action buttons based on user role and book status
            const borrowBtn = document.getElementById('infoPanelBorrowBtn');
            const readBtn = document.getElementById('infoPanelReadBtn');
            
            // Borrow button
            if (book.status === 'available') {
                borrowBtn.style.display = 'flex';
            } else {
                borrowBtn.style.display = 'none';
            }
            
            // Read button
            if (book.pdfFile) {
                readBtn.style.display = 'flex';
            } else {
                readBtn.style.display = 'none';
            }
            
            // Show panel and overlay
            document.getElementById('bookInfoPanel').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }

        // Close book info panel
        function closeBookInfoPanel() {
            document.getElementById('bookInfoPanel').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        // Borrow book from info panel
        function borrowBookFromInfo() {
            if (!currentBookId) return;
            
            const book = libraryData.books.find(b => b.id === currentBookId);
            if (!book || book.status !== 'available') {
                showNotification('Book is not available for borrowing', 'error');
                return;
            }
            
            // For simplicity, we'll directly borrow the book for the current user
            const borrowing = {
                id: libraryData.borrowedBooks.length + 1,
                bookId: currentBookId,
                userId: currentUser.id,
                borrowDate: new Date().toISOString(),
                dueDate: new Date(Date.now() + libraryData.settings.borrowingPeriod * 24 * 60 * 60 * 1000).toISOString(),
                returnDate: null,
                status: "borrowed"
            };
            
            // Update book status
            book.status = 'borrowed';
            
            libraryData.borrowedBooks.push(borrowing);
            saveData();
            
            // Add activity
            addActivity(currentUser.name, 'borrowed', book.title, 'active');
            
            // Update UI
            closeBookInfoPanel();
            loadBooks();
            updateStats();
            showNotification('Book borrowed successfully', 'success');
        }

        // Read book from info panel
        function readBookFromInfo() {
            if (!currentBookId) return;
            
            const book = libraryData.books.find(b => b.id === currentBookId);
            if (!book || !book.pdfFile) {
                showNotification('PDF file not available for this book', 'error');
                return;
            }
            
            // Hide all sections
            document.querySelectorAll('.dashboard').forEach(s => {
                s.style.display = 'none';
            });
            
            // Hide info panel
            closeBookInfoPanel();
            
            // Show PDF reader section
            document.getElementById('pdfReaderSection').style.display = 'block';
            
            // Set PDF reader title
            document.getElementById('pdfReaderTitle').textContent = book.title;
            
            // Load PDF
            loadPDF(book.pdfFile);
        }

        // Load PDF
        function loadPDF(pdfUrl) {
            pdfjsLib.getDocument(pdfUrl).promise.then(function(pdf) {
                pdfDoc = pdf;
                document.getElementById('totalPages').textContent = pdf.numPages;
                
                // Reset current page
                currentPageNum = 1;
                document.getElementById('currentPage').value = 1;
                
                // Render first page
                renderPage(currentPageNum);
            }).catch(function(error) {
                console.error('Error loading PDF:', error);
                showNotification('Error loading PDF', 'error');
            });
        }

        // Render PDF page
        function renderPage(num) {
            pageRendering = true;
            
            pdfDoc.getPage(num).then(function(page) {
                const viewport = page.getViewport({scale: scale});
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                canvas.className = 'pdf-page';
                
                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                
                const renderTask = page.render(renderContext);
                
                renderTask.promise.then(function() {
                    pageRendering = false;
                    
                    // Clear previous content and add new page
                    const content = document.getElementById('pdfReaderContent');
                    content.innerHTML = '';
                    content.appendChild(canvas);
                    
                    // Render next page if pending
                    if (pageNumPending !== null) {
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                });
            });
            
            // Update page counter
            document.getElementById('currentPage').value = num;
        }

        // Queue render page
        function queueRenderPage(num) {
            if (pageRendering) {
                pageNumPending = num;
            } else {
                renderPage(num);
            }
        }

        // Previous page
        function previousPage() {
            if (currentPageNum <= 1) return;
            currentPageNum--;
            queueRenderPage(currentPageNum);
        }

        // Next page
        function nextPage() {
            if (currentPageNum >= pdfDoc.numPages) return;
            currentPageNum++;
            queueRenderPage(currentPageNum);
        }

        // Go to specific page
        function goToPage() {
            const pageNum = parseInt(document.getElementById('currentPage').value);
            if (isNaN(pageNum) || pageNum < 1 || pageNum > pdfDoc.numPages) {
                document.getElementById('currentPage').value = currentPageNum;
                return;
            }
            currentPageNum = pageNum;
            queueRenderPage(currentPageNum);
        }

        // Zoom in
        function zoomIn() {
            scale += 0.25;
            queueRenderPage(currentPageNum);
        }

        // Zoom out
        function zoomOut() {
            if (scale <= 0.5) return;
            scale -= 0.25;
            queueRenderPage(currentPageNum);
        }

        // Download PDF
        function downloadPDF() {
            if (!currentBookId) return;
            
            const book = libraryData.books.find(b => b.id === currentBookId);
            if (!book || !book.pdfFile) return;
            
            const link = document.createElement('a');
            link.href = book.pdfFile;
            link.download = `${book.title}.pdf`;
            link.click();
        }

        // Back to book info
        function backToBookInfo() {
            if (!currentBookId) return;
            showBookInfo(currentBookId);
        }
    </script>
</body>
</html>